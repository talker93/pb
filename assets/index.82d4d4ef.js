import{i as A,B as N,S as f,E as b,y as V,C as w,q as C,I as v,l as j,p as z}from"./vendor.e711fc39.js";const G=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?a.credentials="include":e.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(e){if(e.ep)return;e.ep=!0;const a=o(e);fetch(e.href,a)}};G();const P={apiKey:"AIzaSyB7Jkv647eebeqifG6mAHv40fUyfdDRB8k",authDomain:"fireship-demos-ce28a.firebaseapp.com",databaseURL:"https://fireship-demos-ce28a-default-rtdb.firebaseio.com",projectId:"fireship-demos-ce28a",storageBucket:"fireship-demos-ce28a.appspot.com",messagingSenderId:"710932691797",appId:"1:710932691797:web:5838b9fd459ba264af4ddc",measurementId:"G-FNWH5RC87G"};A(P);const x={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},c=new RTCPeerConnection(x);let m=null,I=null;const S=document.getElementById("webcamButton"),p=document.getElementById("webcamVideo"),k=document.getElementById("callButton"),R=document.getElementById("callInput"),L=document.getElementById("answerButton"),O=document.getElementById("remoteVideo"),J=document.getElementById("hangupButton"),U=document.getElementById("testButton"),F=document.getElementById("remoteVideo"),g=document.getElementById("audioSource"),h=document.getElementById("audioOutput"),B=[g,h];function H(n){const t=B.map(o=>o.value);B.forEach(o=>{for(;o.firstChild;)o.removeChild(o.firstChild)});for(let o=0;o!==n.length;++o){const s=n[o],e=document.createElement("option");e.value=s.deviceId,s.kind==="audioinput"?(e.text=s.label||`microphone ${g.length+1}`,g.appendChild(e)):s.kind==="audiooutput"&&(e.text=s.label||`speaker ${h.length+1}`,h.appendChild(e))}B.forEach((o,s)=>{Array.prototype.slice.call(o.childNodes).some(e=>e.value===t[s])&&(o.value=t[s])})}navigator.mediaDevices.enumerateDevices().then(H).catch(console.log("media query success"));function K(){const n=h.value;F.setSinkId(n).then(console.log("success"))}function T(){return{audio:{deviceId:g.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var M=T();g.addEventListener("change",function(){M=T()});h.onchange=K;S.onclick=async()=>{m=await navigator.mediaDevices.getUserMedia(M),I=new MediaStream,m.getTracks().forEach(n=>{console.log("case1"),c.addTrack(n,m)}),c.ontrack=n=>{console.log("case2"),n.streams[0].getTracks().forEach(t=>{console.log(t),I.addTrack(t)})},p.srcObject=m,O.srcObject=I,p.autoplay=!0,O.autoplay=!0,k.disabled=!1,L.disabled=!1,S.disabled=!0};const E=document.getElementById("muteMonitor");E.checked==!0?p.muted=!0:p.muted=!1;E.addEventListener("change",function(){E.checked==!0?(p.muted=!0,console.log("monitor muted")):(p.muted=!1,console.log("monitor unmuted"))});const D=document.getElementById("muteMe");D.checked=!1;D.addEventListener("change",function(){D.checked==!0?(m.getTracks()[0].enabled=!1,console.log("muted me")):(m.getTracks()[0].enabled=!0,console.log("unmuted me"))});const l=N();k.onclick=async()=>{const n=f(l,"calls1"),t=await b(n,{});R.value=t.id;const o=f(l,"calls1",t.id,"offerCandidates"),s=f(l,"calls1",t.id,"answerCandidates");c.onicecandidate=r=>{r.candidate&&b(o,r.candidate.toJSON())};const e=await c.createOffer();e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await c.setLocalDescription(e),console.log("offerdescription from pa",e);const a={sdp:e.sdp,type:e.type};await V(w(l,"calls1",t.id),{offer:a}),console.log("offer from pa",a);const i=C(w(l,"calls1",t.id));v(i,r=>{const d=r.data();if(!c.currentRemoteDescription&&(d==null?void 0:d.answer)){const u=new RTCSessionDescription(d.answer);c.setRemoteDescription(u),console.log("answerdescription from pa",u)}});const y=C(s);v(y,r=>{r.docChanges().forEach(d=>{if(d.type==="added"){const u=new RTCIceCandidate(d.doc.data());c.addIceCandidate(u),console.log("candidate from pa",u)}})}),J.disabled=!1};L.onclick=async()=>{const n=R.value,t=f(l,"calls1"),o=f(l,"calls1",n,"answerCandidates"),s=f(l,"calls1",n,"offerCandidates");c.onicecandidate=d=>{d.candidate&&b(o,d.candidate.toJSON())};const e=(await j(w(t,n))).data();console.log(e);const a=e.offer;await c.setRemoteDescription(new RTCSessionDescription(a));const i=await c.createAnswer();i.sdp=i.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await c.setLocalDescription(i),console.log("answerDescription from pb",i);const y={type:i.type,sdp:i.sdp};await z(w(l,"calls1",n),{answer:y}),console.log("answer from pb",y);const r=C(s);v(r,d=>{d.docChanges().forEach(u=>{if(u.type==="added"){let q=u.doc.data();c.addIceCandidate(new RTCIceCandidate(q))}})})};U.onclick=async()=>{console.log("button has been pushed")};
