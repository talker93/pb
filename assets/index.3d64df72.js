import{i as se,B as ie,S as y,E as G,y as le,C as g,q as w,I as b,l as de,p as d}from"./vendor.e711fc39.js";const re=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}};re();const ue={apiKey:"AIzaSyBLAS9TSpc8v-273koNVal1Tt1jes7lAQQ",authDomain:"webcodec-64053.firebaseapp.com",projectId:"webcodec-64053",storageBucket:"webcodec-64053.appspot.com",messagingSenderId:"499852745372",appId:"1:499852745372:web:c5d05223a82e7e26c86b59",measurementId:"G-TY670YZV22"};se(ue);const pe={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},i=new RTCPeerConnection(pe);let _=null,j=null;const Y=document.getElementById("webcamButton"),S=document.getElementById("webcamVideo"),F=document.getElementById("callButton"),W=document.getElementById("callInput"),J=document.getElementById("answerButton"),X=document.getElementById("remoteVideo"),me=document.getElementById("hangupButton"),fe=document.getElementById("testButton"),ee=document.getElementById("callMessage"),ve=document.getElementById("sendButton"),K=document.getElementById("dataChannelSend"),Q=document.getElementById("dataChannelReceive");let N,E;ve.onclick=o=>{const s=K.value;N.send(s),console.log("sent data: ")};Nexus.colors.accent="#2596be";Nexus.colors.fill="#333";var ge=new Nexus.Toggle("#muteMo",{state:!0});ge.on("change",function(o){document.getElementById("muteMonitor").click()});var he=new Nexus.Toggle("#muteMy");he.on("change",function(o){document.getElementById("muteMe").click()});var ye=new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});ye.colorize("fill","#eee");var we=new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});we.colorize("fill","#eee");var ne=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});ne.colorize("fill","#eee");ne.on("change",function(o){Y.click()});var T=new Nexus.Dial("#comp_threshold",{size:[50,50],interaction:"radial",mode:"relative",min:-100,max:0,step:1,value:-24}),z=new Nexus.Dial("#comp_knee",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:40,step:1,value:30}),M=new Nexus.Dial("#comp_ratio",{size:[50,50],interaction:"radial",mode:"relative",min:1,max:20,step:1,value:12}),$=new Nexus.Dial("#comp_reduction",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:0,step:1,value:0}),P=new Nexus.Dial("#comp_attack",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.01,value:.003}),C=new Nexus.Dial("#comp_release",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.05,value:.25}),A=new Nexus.Toggle("#comp_bypass");new Nexus.Dial("#reverb",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:10});new Nexus.Toggle("#rev_bypass");var V=new Nexus.Toggle("#eq_bypass"),q=new Nexus.Select("eq_type",{size:[200,20],options:["lowshelf","highshelf"]}),B=new Nexus.Slider("eq_freq",{size:[120,20],mode:"relative",min:20,max:2e4,step:100,value:1e3}),O=new Nexus.Dial("#eq1",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq2",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq3",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});var L=new Nexus.Toggle("#gain_bypass"),x=new Nexus.Dial("#gain",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:2}),R=new Nexus.Toggle("#pan_bypass"),D=new Nexus.Dial("#pan",{size:[50,50],interaction:"radial",mode:"relative",min:-1,max:1,step:.1,value:0});const be=document.getElementById("remoteVideo"),k=document.getElementById("audioSource"),I=document.getElementById("audioOutput"),U=[k,I];function _e(o){const s=U.map(n=>n.value);U.forEach(n=>{for(;n.firstChild;)n.removeChild(n.firstChild)});for(let n=0;n!==o.length;++n){const c=o[n],e=document.createElement("option");e.value=c.deviceId,c.kind==="audioinput"?(e.text=c.label||`microphone ${k.length+1}`,k.appendChild(e)):c.kind==="audiooutput"&&(e.text=c.label||`speaker ${I.length+1}`,I.appendChild(e))}U.forEach((n,c)=>{Array.prototype.slice.call(n.childNodes).some(e=>e.value===s[c])&&(n.value=s[c])})}navigator.mediaDevices.enumerateDevices().then(_e).catch(console.log("media query success"));function xe(){const o=I.value;be.setSinkId(o).then(console.log("success"))}function te(){return{audio:{deviceId:k.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var ae=te();k.addEventListener("change",function(){ae=te()});I.onchange=xe;Y.onclick=async()=>{_=await navigator.mediaDevices.getUserMedia(ae),j=new MediaStream,_.getTracks().forEach(o=>{i.addTrack(o,_)}),i.ontrack=o=>{o.streams[0].getTracks().forEach(s=>{j.addTrack(s)})},X.srcObject=j,S.play(),X.play(),F.disabled=!1,J.disabled=!1,Y.disabled=!0};const Z=document.getElementById("muteMonitor");Z.checked==!0?S.muted=!0:S.muted=!1;Z.addEventListener("change",function(){Z.checked==!0?(S.muted=!0,console.log("monitor muted")):(S.muted=!1,console.log("monitor unmuted"))});const H=document.getElementById("muteMe");H.checked=!1;H.addEventListener("change",function(){H.checked==!0?(_.getTracks()[0].enabled=!1,console.log("muted me")):(_.getTracks()[0].enabled=!0,console.log("unmuted me"))});const u=ie();i.onicegatheringstatechange=o=>{console.log("iceGatheringState: ",i.iceGatheringState)};i.oniceconnectionstatechange=o=>{console.log("iceConnectionState: ",i.iceConnectionState)};i.onconnectionstatechange=o=>{console.log("connection State: ",i.connectionState)};F.onclick=async()=>{N=i.createDataChannel("sendDataChannel"),N.onopen=m=>{K.disabled=!1},N.onclose=m=>{K.disabled=!0};let o=document.createTextNode("You created a call.");ee.appendChild(o);const s=y(u,"calls1"),n=await G(s,{});W.value=n.id;const c=y(u,"calls1",n.id,"offerCandidates"),e=y(u,"calls1",n.id,"answerCandidates");i.onicecandidate=m=>{m.candidate&&G(c,m.candidate.toJSON()),console.log("PA updated candidates in database")};const t=await i.createOffer().then(console.log("PA created offer"));t.sdp=t.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await i.setLocalDescription(t).then(console.log("PA set local desc"));const r={sdp:t.sdp,type:t.type};await le(g(u,"calls1",n.id),{offer:r}).then(console.log("PA updated offer in database"));const p=w(g(u,"calls1",n.id));b(p,m=>{const v=m.data();if(!i.currentRemoteDescription&&(v==null?void 0:v.answer)){const l=new RTCSessionDescription(v.answer);i.setRemoteDescription(l),console.log("PA set remote desc")}});const h=w(e);b(h,m=>{m.docChanges().forEach(v=>{if(v.type==="added"){const l=new RTCIceCandidate(v.doc.data());i.addIceCandidate(l)}})}),me.disabled=!1};J.onclick=async()=>{i.ondatachannel=f=>{E=f.channel,E.onmessage=a=>{Q.value=a.data},E.onopen=a=>{Q.disabled=!1},E.onclose=a=>{Q.disabled=!0}};let o=document.createTextNode("You answered a call!");ee.appendChild(o),F.disabled=!0,J.disabled=!0;const s=W.value,n=y(u,"calls1"),c=y(u,"calls1",s,"answerCandidates"),e=y(u,"calls1",s,"offerCandidates");i.onicecandidate=f=>{f.candidate&&G(c,f.candidate.toJSON()),console.log("PB updated candidate in database")};const r=(await de(g(n,s))).data().offer;await i.setRemoteDescription(new RTCSessionDescription(r)),console.log("PB set remote desc");const p=await i.createAnswer();p.sdp=p.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await i.setLocalDescription(p),console.log("PB set local desc");const h={type:p.type,sdp:p.sdp};await d(g(u,"calls1",s),{answer:h}),console.log("PB updated answer in database");const m=w(e);b(m,f=>{f.docChanges().forEach(a=>{if(a.type==="added"){let ce=a.doc.data();i.addIceCandidate(new RTCIceCandidate(ce))}})});const v=w(g(u,"fxValues","comp"));b(v,f=>{const a=f.data();typeof a.comp_threshold!="undefined"&&(T.value=a.comp_threshold),typeof a.comp_release!="undefined"&&(C.value=a.comp_release),typeof a.comp_attack!="undefined"&&(P.value=a.comp_attack),typeof a.comp_knee!="undefined"&&(z.value=a.comp_knee),typeof a.comp_ratio!="undefined"&&(M.value=a.comp_ratio),typeof a.comp_reduction!="undefined"&&($.value=a.comp_reduction),typeof a.comp_bypass!="undefined"&&(A.state=a.comp_bypass),console.log(a.comp_threshold)});const l=w(g(u,"fxValues","eq"));b(l,f=>{const a=f.data();typeof a.eq_type!="undefined"&&(q.value=a.eq_type),typeof a.eq_freq!="undefined"&&(B.value=a.eq_freq),typeof a.eq1!="undefined"&&(O.value=a.eq1),typeof a.eq_bypass!="undefined"&&(V.state=a.eq_bypass)});const oe=w(g(u,"fxValues","other"));b(oe,f=>{const a=f.data();typeof a.pan!="undefined"&&(D.value=a.pan),typeof a.gain!="undefined"&&(x.value=a.gain),typeof a.gain_bypass!="undefined"&&(L.state=a.gain_bypass),typeof a.pan_bypass!="undefined"&&(R.state=a.pan_bypass)})};fe.onclick=async()=>{console.log("button has been pushed");var o=new AudioContext,s=o.createMediaStreamSource(_),n=o.createBiquadFilter();n.type=q.value,n.frequency.value=B.value,n.gain.value=x.value;var c=o.createStereoPanner();c.pan.value=D.value;var e=o.createGain();e.gain.value=x.value;var t=o.createDynamicsCompressor();t.release.value=C.value,s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination);const r=g(u,"fxValues","comp"),p=g(u,"fxValues","eq"),h=g(u,"fxValues","other");T.on("change",function(l){t.threshold.value=T.value,d(r,{comp_threshold:T.value})}),C.on("change",function(l){t.release.value=C.value,d(r,{comp_release:C.value})}),P.on("change",function(l){t.attack.value=P.value,d(r,{comp_attack:P.value})}),z.on("change",function(l){t.knee.value=z.value,d(r,{comp_knee:z.value})}),M.on("change",function(l){t.ratio.value=M.value,d(r,{comp_ratio:M.value})}),$.on("change",function(l){d(r,{comp_reduction:$.value})}),q.on("change",function(l){n.type=q.value,d(p,{eq_type:q.value})}),B.on("change",function(l){n.frequency.value=B.value,d(p,{eq_freq:B.value})}),O.on("change",function(l){n.gain.value=O.value,d(p,{eq1:O.value})}),D.on("change",function(l){c.pan.value=D.value,d(h,{pan:D.value})}),x.on("change",function(l){e.gain.value=x.value,d(h,{gain:x.value})}),A.on("change",function(l){d(r,{comp_bypass:A.state}),A.state==!0?(t.disconnect(),s.connect(n),n.connect(e),e.connect(c),c.connect(o.destination)):(s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))}),V.on("change",function(l){d(p,{eq_bypass:V.state}),V.state==!0?(n.disconnect(),s.connect(t),t.connect(e),e.connect(c),c.connect(o.destination)):(s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))}),L.on("change",function(l){d(h,{gain_bypass:L.state}),L.state==!0?(e.disconnect(),s.connect(t),t.connect(n),n.connect(c),c.connect(o.destination)):(s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))}),R.on("change",function(l){d(h,{pan_bypass:R.state}),R.state==!0?(c.disconnect(),s.connect(t),t.connect(n),n.connect(e),e.connect(o.destination)):(s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))});var m=new Nexus.Oscilloscope("#oScope");m.connect(s);var v=new Nexus.Spectrogram("#spec");v.connect(s)};
