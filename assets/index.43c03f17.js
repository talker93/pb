import{i as P,B as V,S as f,E as C,y as F,C as y,q as B,I,l as G,p as j}from"./vendor.e711fc39.js";const J=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}};J();const U={apiKey:"AIzaSyB7Jkv647eebeqifG6mAHv40fUyfdDRB8k",authDomain:"fireship-demos-ce28a.firebaseapp.com",databaseURL:"https://fireship-demos-ce28a-default-rtdb.firebaseio.com",projectId:"fireship-demos-ce28a",storageBucket:"fireship-demos-ce28a.appspot.com",messagingSenderId:"710932691797",appId:"1:710932691797:web:5838b9fd459ba264af4ddc",measurementId:"G-FNWH5RC87G"};P(U);const H={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},s=new RTCPeerConnection(H);let p=null,E=null;const k=document.getElementById("webcamButton"),g=document.getElementById("webcamVideo"),S=document.getElementById("callButton"),M=document.getElementById("callInput"),b=document.getElementById("answerButton"),T=document.getElementById("remoteVideo"),K=document.getElementById("hangupButton"),Y=document.getElementById("testButton"),q=document.getElementById("callMessage");Nexus.colors.accent="#2596be";Nexus.colors.fill="#333";var O=new Nexus.Toggle("#muteMo");O.on("change",function(n){document.getElementById("muteMonitor").click()});new Nexus.Toggle("#muteMy");O.on("change",function(n){document.getElementById("muteMe").click()});var $=new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});$.colorize("fill","#eee");var W=new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});W.colorize("fill","#eee");var R=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});R.colorize("fill","#eee");R.on("change",function(n){k.click()});new Nexus.Envelope("#compressor");new Nexus.Slider("#reverb");new Nexus.Slider("#eq1");new Nexus.Slider("#eq2");new Nexus.Slider("#eq3");new Nexus.Slider("#gainValue");new Nexus.Slider("#panValue");const Q=document.getElementById("remoteVideo"),v=document.getElementById("audioSource"),h=document.getElementById("audioOutput"),D=[v,h];function X(n){const a=D.map(t=>t.value);D.forEach(t=>{for(;t.firstChild;)t.removeChild(t.firstChild)});for(let t=0;t!==n.length;++t){const c=n[t],e=document.createElement("option");e.value=c.deviceId,c.kind==="audioinput"?(e.text=c.label||`microphone ${v.length+1}`,v.appendChild(e)):c.kind==="audiooutput"&&(e.text=c.label||`speaker ${h.length+1}`,h.appendChild(e))}D.forEach((t,c)=>{Array.prototype.slice.call(t.childNodes).some(e=>e.value===a[c])&&(t.value=a[c])})}navigator.mediaDevices.enumerateDevices().then(X).catch(console.log("media query success"));function Z(){const n=h.value;Q.setSinkId(n).then(console.log("success"))}function L(){return{audio:{deviceId:v.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var z=L();v.addEventListener("change",function(){z=L()});h.onchange=Z;k.onclick=async()=>{p=await navigator.mediaDevices.getUserMedia(z),E=new MediaStream,p.getTracks().forEach(n=>{s.addTrack(n,p)}),s.ontrack=n=>{console.log("case2"),n.streams[0].getTracks().forEach(a=>{console.log(a),E.addTrack(a)})},T.srcObject=E,g.play(),T.play(),S.disabled=!1,b.disabled=!1,k.disabled=!0};const x=document.getElementById("muteMonitor");x.checked==!0?g.muted=!0:g.muted=!1;x.addEventListener("change",function(){x.checked==!0?(g.muted=!0,console.log("monitor muted")):(g.muted=!1,console.log("monitor unmuted"))});const N=document.getElementById("muteMe");N.checked=!1;N.addEventListener("change",function(){N.checked==!0?(p.getTracks()[0].enabled=!1,console.log("muted me")):(p.getTracks()[0].enabled=!0,console.log("unmuted me"))});const r=V();S.onclick=async()=>{let n=document.createTextNode("You created a call.");q.appendChild(n),S.disabled=!0,b.disabled=!0;const a=f(r,"calls1"),t=await C(a,{});M.value=t.id;const c=f(r,"calls1",t.id,"offerCandidates"),e=f(r,"calls1",t.id,"answerCandidates");s.onicecandidate=u=>{u.candidate&&C(c,u.candidate.toJSON())};const o=await s.createOffer();o.sdp=o.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await s.setLocalDescription(o),console.log("offerdescription from pa",o);const l={sdp:o.sdp,type:o.type};await F(y(r,"calls1",t.id),{offer:l}),console.log("offer from pa",l);const d=B(y(r,"calls1",t.id));I(d,u=>{const i=u.data();if(!s.currentRemoteDescription&&(i==null?void 0:i.answer)){const m=new RTCSessionDescription(i.answer);s.setRemoteDescription(m),console.log("answerdescription from pa",m)}});const w=B(e);I(w,u=>{u.docChanges().forEach(i=>{if(i.type==="added"){const m=new RTCIceCandidate(i.doc.data());s.addIceCandidate(m),console.log("candidate from pa",m)}})}),K.disabled=!1};b.onclick=async()=>{let n=document.createTextNode("You answered a call!");q.appendChild(n),S.disabled=!0,b.disabled=!0;const a=M.value,t=f(r,"calls1"),c=f(r,"calls1",a,"answerCandidates"),e=f(r,"calls1",a,"offerCandidates");s.onicecandidate=i=>{i.candidate&&C(c,i.candidate.toJSON())};const o=(await G(y(t,a))).data();console.log(o);const l=o.offer;await s.setRemoteDescription(new RTCSessionDescription(l));const d=await s.createAnswer();d.sdp=d.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await s.setLocalDescription(d),console.log("answerDescription from pb",d);const w={type:d.type,sdp:d.sdp};await j(y(r,"calls1",a),{answer:w}),console.log("answer from pb",w);const u=B(e);I(u,i=>{i.docChanges().forEach(m=>{if(m.type==="added"){let A=m.doc.data();s.addIceCandidate(new RTCIceCandidate(A))}})})};Y.onclick=async()=>{console.log("button has been pushed");var n=document.querySelector("#gain"),a=document.querySelector("#pan"),t=new AudioContext,c=t.createMediaStreamSource(p),e=t.createBiquadFilter();e.type="lowshelf",e.frequency.value=1e3,e.gain.value=n.value;var o=t.createStereoPanner();o.pan.value=a.value,c.connect(e),e.connect(o),o.connect(t.destination),a.oninput=function(){o.pan.value=a.value},n.oninput=function(){e.gain.value=n.value};var l=new Nexus.Oscilloscope("#oScope");l.connect(c);var d=new Nexus.Spectrogram("#spec");d.connect(c)};
