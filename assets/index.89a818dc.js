import{i as se,B as ie,S as w,E as Y,y as le,C as g,q as _,I as x,l as de,p as d}from"./vendor.e711fc39.js";const re=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}};re();const ue={apiKey:"AIzaSyBLAS9TSpc8v-273koNVal1Tt1jes7lAQQ",authDomain:"webcodec-64053.firebaseapp.com",projectId:"webcodec-64053",storageBucket:"webcodec-64053.appspot.com",messagingSenderId:"499852745372",appId:"1:499852745372:web:c5d05223a82e7e26c86b59",measurementId:"G-TY670YZV22"};se(ue);const pe={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},i=new RTCPeerConnection(pe);let C=null,F=null;const J=document.getElementById("webcamButton"),B=document.getElementById("webcamVideo"),K=document.getElementById("callButton"),W=document.getElementById("callInput"),Q=document.getElementById("answerButton"),X=document.getElementById("remoteVideo"),me=document.getElementById("hangupButton"),fe=document.getElementById("testButton"),ee=document.getElementById("callMessage"),ve=document.getElementById("sendButton"),D=document.getElementById("dataChannelSend"),S=document.getElementById("dataChannelReceive");let b,y;ve.onclick=o=>{const s=D.value;b.send(s),console.log("sent data: ")};Nexus.colors.accent="#2596be";Nexus.colors.fill="#333";var ge=new Nexus.Toggle("#muteMo",{state:!0});ge.on("change",function(o){document.getElementById("muteMonitor").click()});var he=new Nexus.Toggle("#muteMy");he.on("change",function(o){document.getElementById("muteMe").click()});var ye=new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});ye.colorize("fill","#eee");var be=new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});be.colorize("fill","#eee");var ne=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});ne.colorize("fill","#eee");ne.on("change",function(o){J.click()});var M=new Nexus.Dial("#comp_threshold",{size:[50,50],interaction:"radial",mode:"relative",min:-100,max:0,step:1,value:-24}),P=new Nexus.Dial("#comp_knee",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:40,step:1,value:30}),A=new Nexus.Dial("#comp_ratio",{size:[50,50],interaction:"radial",mode:"relative",min:1,max:20,step:1,value:12}),$=new Nexus.Dial("#comp_reduction",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:0,step:1,value:0}),V=new Nexus.Dial("#comp_attack",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.01,value:.003}),k=new Nexus.Dial("#comp_release",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.05,value:.25}),O=new Nexus.Toggle("#comp_bypass");new Nexus.Dial("#reverb",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:10});new Nexus.Toggle("#rev_bypass");var L=new Nexus.Toggle("#eq_bypass"),I=new Nexus.Select("eq_type",{size:[200,20],options:["lowshelf","highshelf"]}),N=new Nexus.Slider("eq_freq",{size:[120,20],mode:"relative",min:20,max:2e4,step:100,value:1e3}),R=new Nexus.Dial("#eq1",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq2",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq3",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});var G=new Nexus.Toggle("#gain_bypass"),q=new Nexus.Dial("#gain",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:2}),j=new Nexus.Toggle("#pan_bypass"),E=new Nexus.Dial("#pan",{size:[50,50],interaction:"radial",mode:"relative",min:-1,max:1,step:.1,value:0});const we=document.getElementById("remoteVideo"),T=document.getElementById("audioSource"),z=document.getElementById("audioOutput"),U=[T,z];function _e(o){const s=U.map(n=>n.value);U.forEach(n=>{for(;n.firstChild;)n.removeChild(n.firstChild)});for(let n=0;n!==o.length;++n){const c=o[n],e=document.createElement("option");e.value=c.deviceId,c.kind==="audioinput"?(e.text=c.label||`microphone ${T.length+1}`,T.appendChild(e)):c.kind==="audiooutput"&&(e.text=c.label||`speaker ${z.length+1}`,z.appendChild(e))}U.forEach((n,c)=>{Array.prototype.slice.call(n.childNodes).some(e=>e.value===s[c])&&(n.value=s[c])})}navigator.mediaDevices.enumerateDevices().then(_e).catch(console.log("media query success"));function xe(){const o=z.value;we.setSinkId(o).then(console.log("success"))}function te(){return{audio:{deviceId:T.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var ae=te();T.addEventListener("change",function(){ae=te()});z.onchange=xe;J.onclick=async()=>{C=await navigator.mediaDevices.getUserMedia(ae),F=new MediaStream,C.getTracks().forEach(o=>{i.addTrack(o,C)}),i.ontrack=o=>{o.streams[0].getTracks().forEach(s=>{F.addTrack(s)})},X.srcObject=F,B.play(),X.play(),K.disabled=!1,Q.disabled=!1,J.disabled=!0};const Z=document.getElementById("muteMonitor");Z.checked==!0?B.muted=!0:B.muted=!1;Z.addEventListener("change",function(){Z.checked==!0?(B.muted=!0,console.log("monitor muted")):(B.muted=!1,console.log("monitor unmuted"))});const H=document.getElementById("muteMe");H.checked=!1;H.addEventListener("change",function(){H.checked==!0?(C.getTracks()[0].enabled=!1,console.log("muted me")):(C.getTracks()[0].enabled=!0,console.log("unmuted me"))});const p=ie();i.onicegatheringstatechange=o=>{console.log("iceGatheringState: ",i.iceGatheringState)};i.oniceconnectionstatechange=o=>{console.log("iceConnectionState: ",i.iceConnectionState)};i.onconnectionstatechange=o=>{console.log("connection State: ",i.connectionState)};K.onclick=async()=>{b=i.createDataChannel("sendDataChannel"),b.onopen=m=>{D.disabled=!1},b.onclose=m=>{D.disabled=!0},i.ondatachannel=m=>{y=m.channel,y.onmessage=u=>{S.value=u.data},y.onopen=u=>{S.disabled=!1},y.onclose=u=>{S.disabled=!0}};let o=document.createTextNode("You created a call.");ee.appendChild(o);const s=w(p,"calls1"),n=await Y(s,{});W.value=n.id;const c=w(p,"calls1",n.id,"offerCandidates"),e=w(p,"calls1",n.id,"answerCandidates");i.onicecandidate=m=>{m.candidate&&Y(c,m.candidate.toJSON()),console.log("PA updated candidates in database")};const t=await i.createOffer().then(console.log("PA created offer"));t.sdp=t.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await i.setLocalDescription(t).then(console.log("PA set local desc"));const r={sdp:t.sdp,type:t.type};await le(g(p,"calls1",n.id),{offer:r}).then(console.log("PA updated offer in database"));const v=_(g(p,"calls1",n.id));x(v,m=>{const u=m.data();if(!i.currentRemoteDescription&&(u==null?void 0:u.answer)){const l=new RTCSessionDescription(u.answer);i.setRemoteDescription(l),console.log("PA set remote desc")}});const h=_(e);x(h,m=>{m.docChanges().forEach(u=>{if(u.type==="added"){const l=new RTCIceCandidate(u.doc.data());i.addIceCandidate(l)}})}),me.disabled=!1};Q.onclick=async()=>{b=i.createDataChannel("sendDataChannel2"),b.onopen=f=>{D.disabled=!1},b.onclose=f=>{D.disabled=!0},i.ondatachannel=f=>{y=f.channel,y.onmessage=a=>{S.value=a.data},y.onopen=a=>{S.disabled=!1},y.onclose=a=>{S.disabled=!0}};let o=document.createTextNode("You answered a call!");ee.appendChild(o),K.disabled=!0,Q.disabled=!0;const s=W.value,n=w(p,"calls1"),c=w(p,"calls1",s,"answerCandidates"),e=w(p,"calls1",s,"offerCandidates");i.onicecandidate=f=>{f.candidate&&Y(c,f.candidate.toJSON()),console.log("PB updated candidate in database")};const r=(await de(g(n,s))).data().offer;await i.setRemoteDescription(new RTCSessionDescription(r)),console.log("PB set remote desc");const v=await i.createAnswer();v.sdp=v.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await i.setLocalDescription(v),console.log("PB set local desc");const h={type:v.type,sdp:v.sdp};await d(g(p,"calls1",s),{answer:h}),console.log("PB updated answer in database");const m=_(e);x(m,f=>{f.docChanges().forEach(a=>{if(a.type==="added"){let ce=a.doc.data();i.addIceCandidate(new RTCIceCandidate(ce))}})});const u=_(g(p,"fxValues","comp"));x(u,f=>{const a=f.data();typeof a.comp_threshold!="undefined"&&(M.value=a.comp_threshold),typeof a.comp_release!="undefined"&&(k.value=a.comp_release),typeof a.comp_attack!="undefined"&&(V.value=a.comp_attack),typeof a.comp_knee!="undefined"&&(P.value=a.comp_knee),typeof a.comp_ratio!="undefined"&&(A.value=a.comp_ratio),typeof a.comp_reduction!="undefined"&&($.value=a.comp_reduction),typeof a.comp_bypass!="undefined"&&(O.state=a.comp_bypass),console.log(a.comp_threshold)});const l=_(g(p,"fxValues","eq"));x(l,f=>{const a=f.data();typeof a.eq_type!="undefined"&&(I.value=a.eq_type),typeof a.eq_freq!="undefined"&&(N.value=a.eq_freq),typeof a.eq1!="undefined"&&(R.value=a.eq1),typeof a.eq_bypass!="undefined"&&(L.state=a.eq_bypass)});const oe=_(g(p,"fxValues","other"));x(oe,f=>{const a=f.data();typeof a.pan!="undefined"&&(E.value=a.pan),typeof a.gain!="undefined"&&(q.value=a.gain),typeof a.gain_bypass!="undefined"&&(G.state=a.gain_bypass),typeof a.pan_bypass!="undefined"&&(j.state=a.pan_bypass)})};fe.onclick=async()=>{console.log("button has been pushed");var o=new AudioContext,s=o.createMediaStreamSource(C),n=o.createBiquadFilter();n.type=I.value,n.frequency.value=N.value,n.gain.value=q.value;var c=o.createStereoPanner();c.pan.value=E.value;var e=o.createGain();e.gain.value=q.value;var t=o.createDynamicsCompressor();t.release.value=k.value,s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination);const r=g(p,"fxValues","comp"),v=g(p,"fxValues","eq"),h=g(p,"fxValues","other");M.on("change",function(l){t.threshold.value=M.value,d(r,{comp_threshold:M.value})}),k.on("change",function(l){t.release.value=k.value,d(r,{comp_release:k.value})}),V.on("change",function(l){t.attack.value=V.value,d(r,{comp_attack:V.value})}),P.on("change",function(l){t.knee.value=P.value,d(r,{comp_knee:P.value})}),A.on("change",function(l){t.ratio.value=A.value,d(r,{comp_ratio:A.value})}),$.on("change",function(l){d(r,{comp_reduction:$.value})}),I.on("change",function(l){n.type=I.value,d(v,{eq_type:I.value})}),N.on("change",function(l){n.frequency.value=N.value,d(v,{eq_freq:N.value})}),R.on("change",function(l){n.gain.value=R.value,d(v,{eq1:R.value})}),E.on("change",function(l){c.pan.value=E.value,d(h,{pan:E.value})}),q.on("change",function(l){e.gain.value=q.value,d(h,{gain:q.value})}),O.on("change",function(l){d(r,{comp_bypass:O.state}),O.state==!0?(t.disconnect(),s.connect(n),n.connect(e),e.connect(c),c.connect(o.destination)):(s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))}),L.on("change",function(l){d(v,{eq_bypass:L.state}),L.state==!0?(n.disconnect(),s.connect(t),t.connect(e),e.connect(c),c.connect(o.destination)):(s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))}),G.on("change",function(l){d(h,{gain_bypass:G.state}),G.state==!0?(e.disconnect(),s.connect(t),t.connect(n),n.connect(c),c.connect(o.destination)):(s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))}),j.on("change",function(l){d(h,{pan_bypass:j.state}),j.state==!0?(c.disconnect(),s.connect(t),t.connect(n),n.connect(e),e.connect(o.destination)):(s.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))});var m=new Nexus.Oscilloscope("#oScope");m.connect(s);var u=new Nexus.Spectrogram("#spec");u.connect(s)};
