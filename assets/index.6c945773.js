import{i as ce,B as ie,S as q,E as F,y as le,C as R,q as Y,I as H,l as re,p as de}from"./vendor.e711fc39.js";const ue=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}};ue();const pe={apiKey:"AIzaSyBLAS9TSpc8v-273koNVal1Tt1jes7lAQQ",authDomain:"webcodec-64053.firebaseapp.com",projectId:"webcodec-64053",storageBucket:"webcodec-64053.appspot.com",messagingSenderId:"499852745372",appId:"1:499852745372:web:c5d05223a82e7e26c86b59",measurementId:"G-TY670YZV22"};ce(pe);const fe={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},p=new RTCPeerConnection(fe);let S=null,K=null,W=0;qe(p);const Q=document.getElementById("webcamButton"),P=document.getElementById("webcamVideo"),V=document.getElementById("callButton"),ee=document.getElementById("callInput"),G=document.getElementById("answerButton"),ae=document.getElementById("remoteVideo"),ge=document.getElementById("hangupButton"),ne=document.getElementById("callMessage");let d,h,a=!1;Nexus.colors.accent="#2596be";Nexus.colors.fill="#333";var me=new Nexus.Toggle("#muteMo",{state:!0});me.on("change",function(c){document.getElementById("muteMonitor").click()});var ve=new Nexus.Toggle("#muteMy");ve.on("change",function(c){document.getElementById("muteMe").click()});var he=new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});he.colorize("fill","#eee");var be=new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});be.colorize("fill","#eee");var te=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});te.colorize("fill","#eee");te.on("change",function(c){Q.click()});var x=new Nexus.Dial("#comp_threshold",{size:[50,50],interaction:"radial",mode:"relative",min:-100,max:0,step:1,value:-24}),N=new Nexus.Dial("#comp_knee",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:40,step:1,value:30}),D=new Nexus.Dial("#comp_ratio",{size:[50,50],interaction:"radial",mode:"relative",min:1,max:20,step:1,value:12}),B=new Nexus.Dial("#comp_attack",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.01,value:.003}),w=new Nexus.Dial("#comp_release",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.05,value:.25}),I=new Nexus.Toggle("#comp_bypass");new Nexus.Dial("#reverb",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:10});new Nexus.Toggle("#rev_bypass");var E=new Nexus.Toggle("#eq_bypass"),y=new Nexus.Select("eq_type",{size:[200,20],options:["lowshelf","highshelf"]}),k=new Nexus.Slider("eq_freq",{size:[120,20],mode:"relative",min:20,max:2e4,step:100,value:1e3}),O=new Nexus.Dial("#eq1",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10}),T=new Nexus.Dial("#eq2",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10}),_=new Nexus.Dial("#eq3",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10}),M=new Nexus.Toggle("#gain_bypass"),b=new Nexus.Dial("#gain",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:2}),z=new Nexus.Toggle("#pan_bypass"),C=new Nexus.Dial("#pan",{size:[50,50],interaction:"radial",mode:"relative",min:-1,max:1,step:.1,value:0}),e={comp:{attack:B.value,bypass:I.state,knee:N.value,ratio:D.value,release:w.value,threshold:x.value},eq:{low:O.value,mid:T.value,high:_.value,bypass:E.state,freq:k.value,type:y.value},pan:{bypass:z.state,pan:C.value},gain:{bypass:M.state,gain:b.value},whatChanged:"none"};const we=document.getElementById("remoteVideo"),A=document.getElementById("audioSource"),L=document.getElementById("audioOutput"),$=[A,L];function ye(c){const l=$.map(t=>t.value);$.forEach(t=>{for(;t.firstChild;)t.removeChild(t.firstChild)});for(let t=0;t!==c.length;++t){const r=c[t],o=document.createElement("option");o.value=r.deviceId,r.kind==="audioinput"?(o.text=r.label||`microphone ${A.length+1}`,A.appendChild(o)):r.kind==="audiooutput"&&(o.text=r.label||`speaker ${L.length+1}`,L.appendChild(o))}$.forEach((t,r)=>{Array.prototype.slice.call(t.childNodes).some(o=>o.value===l[r])&&(t.value=l[r])})}navigator.mediaDevices.enumerateDevices().then(ye).catch(console.log("media query success"));function ke(){const c=L.value;we.setSinkId(c).then(console.log("success"))}function oe(){return{audio:{deviceId:A.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var se=oe();A.addEventListener("change",function(){se=oe()});L.onchange=ke;Q.onclick=async()=>{S=await navigator.mediaDevices.getUserMedia(se),K=new MediaStream,S.getTracks().forEach(c=>{p.addTrack(c,S)}),p.ontrack=c=>{c.streams[0].getTracks().forEach(l=>{K.addTrack(l)})},ae.srcObject=K,P.play(),ae.play(),V.disabled=!1,G.disabled=!1,Q.disabled=!0,Ce()};const U=document.getElementById("muteMonitor");U.checked==!0?P.muted=!0:P.muted=!1;U.addEventListener("change",function(){U.checked==!0?(P.muted=!0,console.log("monitor muted")):(P.muted=!1,console.log("monitor unmuted"))});const X=document.getElementById("muteMe");X.checked=!1;X.addEventListener("change",function(){X.checked==!0?(S.getTracks()[0].enabled=!1,console.log("muted me")):(S.getTracks()[0].enabled=!0,console.log("unmuted me"))});const v=ie();V.onclick=async()=>{d=p.createDataChannel("sendDataChannel"),d.onopen=f=>{console.log("send channel opened")},d.onclose=f=>{console.log("send channel closed")},p.ondatachannel=f=>{h=f.channel,h.onmessage=async s=>{switch(a=!0,e=JSON.parse(s.data),e.whatChanged){case"comp.threshold":await(x.value=e.comp.threshold),a=!1;break;case"comp.release":await(w.value=e.comp.release),a=!1;break;case"comp.attack":await(B.value=e.comp.attack),a=!1;break;case"comp.knee":await(N.value=e.comp.knee),a=!1;break;case"comp.ratio":await(D.value=e.comp.ratio),a=!1;break;case"comp.reduction":await(comp_recduction.value=e.comp.reduction),a=!1;break;case"eq.type":await(y.value=e.eq.type),a=!1;break;case"eq.freq":await(k.value=e.eq.freq),a=!1;break;case"eq.low":await(O.value=e.eq.low),a=!1;break;case"eq.mid":await(T.value=e.eq.mid),a=!1;break;case"eq.high":await(_.value=e.eq.high),a=!1;break;case"pan.pan":await(C.value=e.pan.pan),a=!1;break;case"gain.gain":await(b.value=e.gain.gain),a=!1;break;case"comp.bypass":await(I.state=e.comp.bypass),a=!1;break;case"eq.bypass":await(E.state=e.eq.bypass),a=!1;break;case"gain.bypass":await(M.state=e.gain.bypass),a=!1;break;case"pan.bypass":await(z.state=e.pan.bypass),a=!1;break;default:console.log("invalid exchanged value"),a=!1;break}},h.onopen=s=>{console.log("receive channel opened"),u()},h.onclose=s=>{console.log("receive channel closed"),u()}};let c=document.createTextNode("You created a call.");ne.appendChild(c),V.disabled=!0,G.disabled=!0;const l=q(v,"calls1"),t=await F(l,{});ee.value=t.id;const r=q(v,"calls1",t.id,"offerCandidates"),o=q(v,"calls1",t.id,"answerCandidates");p.onicecandidate=f=>{f.candidate&&F(r,f.candidate.toJSON()),console.log("PA updated candidates in database"),u()};const i=await p.createOffer().then(console.log("PA created offer"));u(),i.sdp=i.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await p.setLocalDescription(i).then(console.log("PA set local desc")),u();const m={sdp:i.sdp,type:i.type};await le(R(v,"calls1",t.id),{offer:m}).then(console.log("PA updated offer in database")),u();const g=Y(R(v,"calls1",t.id));H(g,f=>{const s=f.data();if(!p.currentRemoteDescription&&(s==null?void 0:s.answer)){console.log("listen to answer triggered"),u();const n=new RTCSessionDescription(s.answer);p.setRemoteDescription(n),console.log("PA set remote desc",n),u()}});const J=Y(o);H(J,f=>{f.docChanges().forEach(s=>{if(s.type==="added"){console.log("listen to answerCandidates triggered"),u();const n=new RTCIceCandidate(s.doc.data());p.addIceCandidate(n),console.log("PA added ICE Candi: ",n),u()}})}),ge.disabled=!1};G.onclick=async()=>{d=p.createDataChannel("sendDataChannel2"),d.onopen=s=>{console.log("send channel opened")},d.onclose=s=>{console.log("send channel closed")},p.ondatachannel=s=>{h=s.channel,h.onmessage=async n=>{switch(a=!0,e=JSON.parse(n.data),e.whatChanged){case"comp.threshold":await(x.value=e.comp.threshold),a=!1;break;case"comp.release":await(w.value=e.comp.release),a=!1;break;case"comp.attack":await(B.value=e.comp.attack),a=!1;break;case"comp.knee":await(N.value=e.comp.knee),a=!1;break;case"comp.ratio":await(D.value=e.comp.ratio),a=!1;break;case"comp.reduction":await(comp_recduction.value=e.comp.reduction),a=!1;break;case"eq.type":await(y.value=e.eq.type),a=!1;break;case"eq.freq":await(k.value=e.eq.freq),a=!1;break;case"eq.low":await(O.value=e.eq.low),a=!1;break;case"eq.mid":await(T.value=e.eq.mid),a=!1;break;case"eq.high":await(_.value=e.eq.high),a=!1;break;case"pan.pan":await(C.value=e.pan.pan),a=!1;break;case"gain.gain":await(b.value=e.gain.gain),a=!1;break;case"comp.bypass":await(I.state=e.comp.bypass),a=!1;break;case"eq.bypass":await(E.state=e.eq.bypass),a=!1;break;case"gain.bypass":await(M.state=e.gain.bypass),a=!1;break;case"pan.bypass":await(z.state=e.pan.bypass),a=!1;break;default:console.log("invalid exchanged value");break}},h.onopen=n=>{console.log("receive channel opened"),u()},h.onclose=n=>{console.log("receive channel closed"),u()}};let c=document.createTextNode("You answered a call!");ne.appendChild(c),V.disabled=!0,G.disabled=!0;const l=ee.value,t=q(v,"calls1"),r=q(v,"calls1",l,"answerCandidates"),o=q(v,"calls1",l,"offerCandidates");p.onicecandidate=s=>{s.candidate&&F(r,s.candidate.toJSON()),console.log("PB updated candidate in database"),u()};const m=(await re(R(t,l))).data().offer;await p.setRemoteDescription(new RTCSessionDescription(m)),console.log("PB set remote desc"),u();const g=await p.createAnswer();g.sdp=g.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await p.setLocalDescription(g),console.log("PB set local desc"),u();const J={type:g.type,sdp:g.sdp};await de(R(v,"calls1",l),{answer:J}),console.log("PB updated answer in database"),u();const f=Y(o);H(f,s=>{s.docChanges().forEach(n=>{if(n.type==="added"){let j=n.doc.data(),Z=new RTCIceCandidate(j);p.addIceCandidate(Z),console.log("PB added ICE Candi: ",Z),u()}})})};async function Ce(){console.log("button has been pushed");var c=new AudioContext,l=c.createMediaStreamSource(S),t=c.createBiquadFilter();t.type=y.value,t.frequency.value=k.value,t.gain.value=b.value;var r=c.createStereoPanner();r.pan.value=C.value;var o=c.createGain();o.gain.value=b.value;var i=c.createDynamicsCompressor();i.release.value=w.value;var m=c.createConvolver(),g=new XMLHttpRequest;g.open("GET","https://talker93.github.io/pb/audio/Block%20Inside.wav",!0),g.responseType="arraybuffer",g.onload=function(){var s=g.response;c.decodeAudioData(s,function(n){c.createBufferSource(),m.buffer=n},function(n){""+n.err})},g.send(),l.connect(i),i.connect(t),t.connect(m),m.connect(o),o.connect(r),r.connect(c.destination),x.on("change",function(s){if(i.threshold.value=x.value,e.comp.threshold=x.value,e.whatChanged="comp.threshold",!a){const n=JSON.stringify(e);try{d.send(n)}catch(j){console.error(j)}console.log("threshold: ",e.comp.threshold)}}),w.on("change",function(s){if(i.release.value=w.value,e.comp.release=w.value,e.whatChanged="comp.release",!a){const n=JSON.stringify(e);d.send(n)}}),B.on("change",function(s){if(i.attack.value=B.value,e.comp.attack=B.value,e.whatChanged="comp.attack",!a){const n=JSON.stringify(e);d.send(n)}}),N.on("change",function(s){if(i.knee.value=N.value,e.comp.knee=N.value,e.whatChanged="comp.knee",!a){const n=JSON.stringify(e);d.send(n)}}),D.on("change",function(s){if(i.ratio.value=D.value,e.comp.ratio=D.value,e.whatChanged="comp.ratio",!a){const n=JSON.stringify(e);d.send(n)}}),y.on("change",function(s){if(t.type=y.value,e.eq.type=y.value,e.whatChanged="eq.type",!a){const n=JSON.stringify(e);d.send(n)}}),k.on("change",function(s){if(t.frequency.value=k.value,e.eq.freq=k.value,e.whatChanged="eq.freq",!a){const n=JSON.stringify(e);d.send(n)}}),O.on("change",function(s){if(t.gain.value=O.value,e.eq.low=O.value,e.whatChanged="eq.low",!a){const n=JSON.stringify(e);d.send(n)}}),T.on("change",function(s){if(t.gain.value=T.value,e.eq.mid=T.value,e.whatChanged="eq.mid",!a){const n=JSON.stringify(e);d.send(n)}}),_.on("change",function(s){if(t.gain.value=_.value,e.eq.high=_.value,e.whatChanged="eq.high",!a){const n=JSON.stringify(e);d.send(n)}}),C.on("change",function(s){if(r.pan.value=C.value,e.pan.pan=C.value,e.whatChanged="pan.pan",!a){const n=JSON.stringify(e);d.send(n)}}),b.on("change",function(s){if(o.gain.value=b.value,e.gain.gain=b.value,e.whatChanged="gain.gain",!a){const n=JSON.stringify(e);d.send(n)}}),I.on("change",function(s){if(I.state==!0?(i.disconnect(),l.connect(t)):(l.disconnect(t),l.connect(i),i.connect(t)),e.comp.bypass=I.state,e.whatChanged="comp.bypass",!a){const n=JSON.stringify(e);d.send(n)}}),E.on("change",function(s){if(E.state==!0?(t.disconnect(),i.connect(o)):(i.disconnect(o),i.connect(t),t.connect(o)),e.eq.bypass=E.state,e.whatChanged="eq.bypass",!a){const n=JSON.stringify(e);d.send(n)}}),M.on("change",function(s){if(M.state==!0?(o.disconnect(),t.connect(r)):(t.disconnect(r),t.connect(o),o.connect(r)),e.gain.bypass=M.state,e.whatChanged="gain.bypass",!a){const n=JSON.stringify(e);d.send(n)}}),z.on("change",function(s){if(z.state==!0?(r.disconnect(),o.connect(c.destination)):(o.disconnect(c.destination),o.connect(r),r.connect(c.destination)),e.pan.bypass=z.state,e.whatChanged="pan.bypass",!a){const n=JSON.stringify(e);d.send(n)}});var J=new Nexus.Oscilloscope("#oScope");J.connect(l);var f=new Nexus.Spectrogram("#spec");f.connect(l)}function qe(c){c.onicegatheringstatechange=l=>{console.log("iceGatheringState: ",c.iceGatheringState),u()},c.oniceconnectionstatechange=l=>{console.log("iceConnectionState: ",c.iceConnectionState),u()},c.onconnectionstatechange=l=>{console.log("connectionState: ",c.connectionState),u()}}function u(){W=Math.floor(Date.now()%1e5),console.log("time elapsed: ",W)}
