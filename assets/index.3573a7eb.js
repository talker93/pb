import{i as se,B as ce,S as h,E as D,y as ie,C as q,q as B,I,l as le,p as re}from"./vendor.e711fc39.js";const de=function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const g of i.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}};de();const ue={apiKey:"AIzaSyBLAS9TSpc8v-273koNVal1Tt1jes7lAQQ",authDomain:"webcodec-64053.firebaseapp.com",projectId:"webcodec-64053",storageBucket:"webcodec-64053.appspot.com",messagingSenderId:"499852745372",appId:"1:499852745372:web:c5d05223a82e7e26c86b59",measurementId:"G-TY670YZV22"};se(ue);const pe={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},l=new RTCPeerConnection(pe);let w=null,N=null,H=0;ke(l);const E=document.getElementById("webcamButton"),b=document.getElementById("webcamVideo"),C=document.getElementById("callButton"),W=document.getElementById("callInput"),x=document.getElementById("answerButton"),X=document.getElementById("remoteVideo"),me=document.getElementById("hangupButton"),ee=document.getElementById("callMessage");let f,m;Nexus.colors.accent="#2596be";Nexus.colors.fill="#333";var ge=new Nexus.Toggle("#muteMo",{state:!0});ge.on("change",function(t){document.getElementById("muteMonitor").click()});var ve=new Nexus.Toggle("#muteMy");ve.on("change",function(t){document.getElementById("muteMe").click()});var he=new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});he.colorize("fill","#eee");var fe=new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});fe.colorize("fill","#eee");var ae=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});ae.colorize("fill","#eee");ae.on("change",function(t){E.click()});var T=new Nexus.Dial("#comp_threshold",{size:[50,50],interaction:"radial",mode:"relative",min:-100,max:0,step:1,value:-24}),_=new Nexus.Dial("#comp_knee",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:40,step:1,value:30}),z=new Nexus.Dial("#comp_ratio",{size:[50,50],interaction:"radial",mode:"relative",min:1,max:20,step:1,value:12}),M=new Nexus.Dial("#comp_attack",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.01,value:.003}),P=new Nexus.Dial("#comp_release",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.05,value:.25}),A=new Nexus.Toggle("#comp_bypass");new Nexus.Dial("#reverb",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:10});new Nexus.Toggle("#rev_bypass");var O=new Nexus.Toggle("#eq_bypass"),L=new Nexus.Select("eq_type",{size:[200,20],options:["lowshelf","highshelf"]}),R=new Nexus.Slider("eq_freq",{size:[120,20],mode:"relative",min:20,max:2e4,step:100,value:1e3}),V=new Nexus.Dial("#eq1",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10}),j=new Nexus.Dial("#eq2",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10}),G=new Nexus.Dial("#eq3",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10}),J=new Nexus.Toggle("#gain_bypass"),Y=new Nexus.Dial("#gain",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:2}),K=new Nexus.Toggle("#pan_bypass"),Q=new Nexus.Dial("#pan",{size:[50,50],interaction:"radial",mode:"relative",min:-1,max:1,step:.1,value:0}),e={comp:{attack:M.value,bypass:A.state,knee:_.value,ratio:z.value,release:P.value,threshold:T.value},eq:{low:V.value,mid:j.value,high:G.value,bypass:O.state,freq:R.value,type:L.value},pan:{bypass:K.state,pan:Q.value},gain:{bypass:J.state,gain:Y.value},whatChanged:"none"};const we=document.getElementById("remoteVideo"),y=document.getElementById("audioSource"),k=document.getElementById("audioOutput"),$=[y,k];function be(t){const c=$.map(n=>n.value);$.forEach(n=>{for(;n.firstChild;)n.removeChild(n.firstChild)});for(let n=0;n!==t.length;++n){const r=t[n],a=document.createElement("option");a.value=r.deviceId,r.kind==="audioinput"?(a.text=r.label||`microphone ${y.length+1}`,y.appendChild(a)):r.kind==="audiooutput"&&(a.text=r.label||`speaker ${k.length+1}`,k.appendChild(a))}$.forEach((n,r)=>{Array.prototype.slice.call(n.childNodes).some(a=>a.value===c[r])&&(n.value=c[r])})}navigator.mediaDevices.enumerateDevices().then(be).catch(console.log("media query success"));function ye(){const t=k.value;we.setSinkId(t).then(console.log("success"))}function te(){return{audio:{deviceId:y.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var ne=te();y.addEventListener("change",function(){ne=te()});k.onchange=ye;E.onclick=async()=>{w=await navigator.mediaDevices.getUserMedia(ne),N=new MediaStream,w.getTracks().forEach(t=>{l.addTrack(t,w)}),l.ontrack=t=>{t.streams[0].getTracks().forEach(c=>{N.addTrack(c)})},X.srcObject=N,b.play(),X.play(),C.disabled=!1,x.disabled=!1,E.disabled=!0};const F=document.getElementById("muteMonitor");F.checked==!0?b.muted=!0:b.muted=!1;F.addEventListener("change",function(){F.checked==!0?(b.muted=!0,console.log("monitor muted")):(b.muted=!1,console.log("monitor unmuted"))});const U=document.getElementById("muteMe");U.checked=!1;U.addEventListener("change",function(){U.checked==!0?(w.getTracks()[0].enabled=!1,console.log("muted me")):(w.getTracks()[0].enabled=!0,console.log("unmuted me"))});const p=ce();C.onclick=async()=>{f=l.createDataChannel("sendDataChannel"),f.onopen=d=>{console.log("send channel opened")},f.onclose=d=>{console.log("send channel closed")},l.ondatachannel=d=>{m=d.channel,m.onmessage=async o=>{switch(e=JSON.parse(o.data),e.whatChanged){case"comp.threshold":await(T.value=e.comp.threshold);break;case"comp.release":await(P.value=e.comp.release);break;case"comp.attack":await(M.value=e.comp.attack);break;case"comp.knee":await(_.value=e.comp.knee);break;case"comp.ratio":await(z.value=e.comp.ratio);break;case"comp.reduction":await(comp_recduction.value=e.comp.reduction);break;case"eq.type":await(L.value=e.eq.type);break;case"eq.freq":await(R.value=e.eq.freq);break;case"eq.low":await(V.value=e.eq.low);break;case"eq.mid":await(j.value=e.eq.mid);break;case"eq.high":await(G.value=e.eq.high);break;case"pan.pan":await(Q.value=e.pan.pan);break;case"gain.gain":await(Y.value=e.gain.gain);break;case"comp.bypass":await(A.state=e.comp.bypass);break;case"eq.bypass":await(O.state=e.eq.bypass);break;case"gain.bypass":await(J.state=e.gain.bypass);break;case"pan.bypass":await(K.state=e.pan.bypass);break;default:console.log("invalid exchanged value");break}},m.onopen=o=>{console.log("receive channel opened"),s()},m.onclose=o=>{console.log("receive channel closed"),s()}};let t=document.createTextNode("You created a call.");ee.appendChild(t),C.disabled=!0,x.disabled=!0;const c=h(p,"calls1"),n=await D(c,{});W.value=n.id;const r=h(p,"calls1",n.id,"offerCandidates"),a=h(p,"calls1",n.id,"answerCandidates");l.onicecandidate=d=>{d.candidate&&D(r,d.candidate.toJSON()),console.log("PA updated candidates in database"),s()};const i=await l.createOffer().then(console.log("PA created offer"));s(),i.sdp=i.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await l.setLocalDescription(i).then(console.log("PA set local desc")),s();const g={sdp:i.sdp,type:i.type};await ie(q(p,"calls1",n.id),{offer:g}).then(console.log("PA updated offer in database")),s();const v=B(q(p,"calls1",n.id));I(v,d=>{const o=d.data();if(!l.currentRemoteDescription&&(o==null?void 0:o.answer)){console.log("listen to answer triggered"),s();const u=new RTCSessionDescription(o.answer);l.setRemoteDescription(u),console.log("PA set remote desc",u),s()}});const S=B(a);I(S,d=>{d.docChanges().forEach(o=>{if(o.type==="added"){console.log("listen to answerCandidates triggered"),s();const u=new RTCIceCandidate(o.doc.data());l.addIceCandidate(u),console.log("PA added ICE Candi: ",u),s()}})}),me.disabled=!1};x.onclick=async()=>{f=l.createDataChannel("sendDataChannel2"),f.onopen=o=>{console.log("send channel opened")},f.onclose=o=>{console.log("send channel closed")},l.ondatachannel=o=>{m=o.channel,m.onmessage=async u=>{switch(e=JSON.parse(u.data),e.whatChanged){case"comp.threshold":await(T.value=e.comp.threshold);break;case"comp.release":await(P.value=e.comp.release);break;case"comp.attack":await(M.value=e.comp.attack);break;case"comp.knee":await(_.value=e.comp.knee);break;case"comp.ratio":await(z.value=e.comp.ratio);break;case"comp.reduction":await(comp_recduction.value=e.comp.reduction);break;case"eq.type":await(L.value=e.eq.type);break;case"eq.freq":await(R.value=e.eq.freq);break;case"eq.low":await(V.value=e.eq.low);break;case"eq.mid":await(j.value=e.eq.mid);break;case"eq.high":await(G.value=e.eq.high);break;case"pan.pan":await(Q.value=e.pan.pan);break;case"gain.gain":await(Y.value=e.gain.gain);break;case"comp.bypass":await(A.state=e.comp.bypass);break;case"eq.bypass":await(O.state=e.eq.bypass);break;case"gain.bypass":await(J.state=e.gain.bypass);break;case"pan.bypass":await(K.state=e.pan.bypass);break;default:console.log("invalid exchanged value");break}},m.onopen=u=>{console.log("receive channel opened"),s()},m.onclose=u=>{console.log("receive channel closed"),s()}};let t=document.createTextNode("You answered a call!");ee.appendChild(t),C.disabled=!0,x.disabled=!0;const c=W.value,n=h(p,"calls1"),r=h(p,"calls1",c,"answerCandidates"),a=h(p,"calls1",c,"offerCandidates");l.onicecandidate=o=>{o.candidate&&D(r,o.candidate.toJSON()),console.log("PB updated candidate in database"),s()};const g=(await le(q(n,c))).data().offer;await l.setRemoteDescription(new RTCSessionDescription(g)),console.log("PB set remote desc"),s();const v=await l.createAnswer();v.sdp=v.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await l.setLocalDescription(v),console.log("PB set local desc"),s();const S={type:v.type,sdp:v.sdp};await re(q(p,"calls1",c),{answer:S}),console.log("PB updated answer in database"),s();const d=B(a);I(d,o=>{o.docChanges().forEach(u=>{if(u.type==="added"){let oe=u.doc.data(),Z=new RTCIceCandidate(oe);l.addIceCandidate(Z),console.log("PB added ICE Candi: ",Z),s()}})})};function ke(t){t.onicegatheringstatechange=c=>{console.log("iceGatheringState: ",t.iceGatheringState),s()},t.oniceconnectionstatechange=c=>{console.log("iceConnectionState: ",t.iceConnectionState),s()},t.onconnectionstatechange=c=>{console.log("connectionState: ",t.connectionState),s()}}function s(){H=Math.floor(Date.now()%1e5),console.log("time elapsed: ",H)}
