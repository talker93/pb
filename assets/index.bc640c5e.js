import{i as A,B as N,S as f,E as w,y as V,C as v,q as b,I as C,l as P,p as x}from"./vendor.e711fc39.js";const z=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function t(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?a.credentials="include":e.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(e){if(e.ep)return;e.ep=!0;const a=t(e);fetch(e.href,a)}};z();const F={apiKey:"AIzaSyB7Jkv647eebeqifG6mAHv40fUyfdDRB8k",authDomain:"fireship-demos-ce28a.firebaseapp.com",databaseURL:"https://fireship-demos-ce28a-default-rtdb.firebaseio.com",projectId:"fireship-demos-ce28a",storageBucket:"fireship-demos-ce28a.appspot.com",messagingSenderId:"710932691797",appId:"1:710932691797:web:5838b9fd459ba264af4ddc",measurementId:"G-FNWH5RC87G"};A(F);const G={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},s=new RTCPeerConnection(G);let m=null,I=null;const D=document.getElementById("webcamButton"),p=document.getElementById("webcamVideo"),k=document.getElementById("callButton"),q=document.getElementById("callInput"),R=document.getElementById("answerButton"),L=document.getElementById("remoteVideo"),j=document.getElementById("hangupButton"),J=document.getElementById("testButton"),U=document.getElementById("remoteVideo"),g=document.getElementById("audioSource"),h=document.getElementById("audioOutput"),B=[g,h];function H(n){const o=B.map(t=>t.value);B.forEach(t=>{for(;t.firstChild;)t.removeChild(t.firstChild)});for(let t=0;t!==n.length;++t){const c=n[t],e=document.createElement("option");e.value=c.deviceId,c.kind==="audioinput"?(e.text=c.label||`microphone ${g.length+1}`,g.appendChild(e)):c.kind==="audiooutput"&&(e.text=c.label||`speaker ${h.length+1}`,h.appendChild(e))}B.forEach((t,c)=>{Array.prototype.slice.call(t.childNodes).some(e=>e.value===o[c])&&(t.value=o[c])})}navigator.mediaDevices.enumerateDevices().then(H).catch(console.log("media query success"));function K(){const n=h.value;U.setSinkId(n).then(console.log("success"))}function T(){return{audio:{deviceId:g.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var M=T();g.addEventListener("change",function(){M=T()});h.onchange=K;D.onclick=async()=>{m=await navigator.mediaDevices.getUserMedia(M),I=new MediaStream,m.getTracks().forEach(n=>{s.addTrack(n,m)}),s.ontrack=n=>{console.log("case2"),n.streams[0].getTracks().forEach(o=>{console.log(o),I.addTrack(o)})},L.srcObject=I,p.play(),L.play(),k.disabled=!1,R.disabled=!1,D.disabled=!0};const E=document.getElementById("muteMonitor");E.checked==!0?p.muted=!0:p.muted=!1;E.addEventListener("change",function(){E.checked==!0?(p.muted=!0,console.log("monitor muted")):(p.muted=!1,console.log("monitor unmuted"))});const S=document.getElementById("muteMe");S.checked=!1;S.addEventListener("change",function(){S.checked==!0?(m.getTracks()[0].enabled=!1,console.log("muted me")):(m.getTracks()[0].enabled=!0,console.log("unmuted me"))});const r=N();k.onclick=async()=>{const n=f(r,"calls1"),o=await w(n,{});q.value=o.id;const t=f(r,"calls1",o.id,"offerCandidates"),c=f(r,"calls1",o.id,"answerCandidates");s.onicecandidate=l=>{l.candidate&&w(t,l.candidate.toJSON())};const e=await s.createOffer();e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await s.setLocalDescription(e),console.log("offerdescription from pa",e);const a={sdp:e.sdp,type:e.type};await V(v(r,"calls1",o.id),{offer:a}),console.log("offer from pa",a);const i=b(v(r,"calls1",o.id));C(i,l=>{const d=l.data();if(!s.currentRemoteDescription&&(d==null?void 0:d.answer)){const u=new RTCSessionDescription(d.answer);s.setRemoteDescription(u),console.log("answerdescription from pa",u)}});const y=b(c);C(y,l=>{l.docChanges().forEach(d=>{if(d.type==="added"){const u=new RTCIceCandidate(d.doc.data());s.addIceCandidate(u),console.log("candidate from pa",u)}})}),j.disabled=!1};R.onclick=async()=>{const n=q.value,o=f(r,"calls1"),t=f(r,"calls1",n,"answerCandidates"),c=f(r,"calls1",n,"offerCandidates");s.onicecandidate=d=>{d.candidate&&w(t,d.candidate.toJSON())};const e=(await P(v(o,n))).data();console.log(e);const a=e.offer;await s.setRemoteDescription(new RTCSessionDescription(a));const i=await s.createAnswer();i.sdp=i.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await s.setLocalDescription(i),console.log("answerDescription from pb",i);const y={type:i.type,sdp:i.sdp};await x(v(r,"calls1",n),{answer:y}),console.log("answer from pb",y);const l=b(c);C(l,d=>{d.docChanges().forEach(u=>{if(u.type==="added"){let O=u.doc.data();s.addIceCandidate(new RTCIceCandidate(O))}})})};J.onclick=async()=>{console.log("button has been pushed");var n=document.querySelector("#gain"),o=document.querySelector("#pan"),t=new AudioContext,c=t.createMediaStreamSource(m),e=t.createBiquadFilter();e.type="lowshelf",e.frequency.value=1e3,e.gain.value=n.value;var a=t.createStereoPanner();a.pan.value=o.value,c.connect(e),e.connect(a),a.connect(t.destination),o.oninput=function(){a.pan.value=o.value},n.oninput=function(){e.gain.value=n.value}};
