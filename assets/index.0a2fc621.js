import{i as ie,B as re,S as y,E as L,y as de,C,q as N,I,l as ue,p as f}from"./vendor.e711fc39.js";const me=function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}};me();const pe={apiKey:"AIzaSyB7Jkv647eebeqifG6mAHv40fUyfdDRB8k",authDomain:"fireship-demos-ce28a.firebaseapp.com",databaseURL:"https://fireship-demos-ce28a-default-rtdb.firebaseio.com",projectId:"fireship-demos-ce28a",storageBucket:"fireship-demos-ce28a.appspot.com",messagingSenderId:"710932691797",appId:"1:710932691797:web:5838b9fd459ba264af4ddc",measurementId:"G-FNWH5RC87G"};ie(pe);const ve={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},l=new RTCPeerConnection(ve);let w=null,G=null,v,g;const h=document.querySelector("textarea#dataChannelSend");document.querySelector("textarea#dataChannelReceive");const A=document.querySelector("button#startButton"),q=document.querySelector("button#sendButton"),x=document.querySelector("button#closeButton");A.onclick=ke;q.onclick=De;x.onclick=_e;const V=document.getElementById("webcamButton"),S=document.getElementById("webcamVideo"),E=document.getElementById("callButton"),Y=document.getElementById("callInput"),z=document.getElementById("answerButton"),W=document.getElementById("remoteVideo"),fe=document.getElementById("hangupButton"),ge=document.getElementById("testButton"),Q=document.getElementById("callMessage");Nexus.colors.accent="#2596be";Nexus.colors.fill="#333";var he=new Nexus.Toggle("#muteMo",{state:!0});he.on("change",function(a){document.getElementById("muteMonitor").click()});var be=new Nexus.Toggle("#muteMy");be.on("change",function(a){document.getElementById("muteMe").click()});var ye=new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});ye.colorize("fill","#eee");var Ce=new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});Ce.colorize("fill","#eee");var X=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});X.colorize("fill","#eee");X.on("change",function(a){V.click()});var M=new Nexus.Dial("#comp_threshold",{size:[50,50],interaction:"radial",mode:"relative",min:-100,max:0,step:1,value:-24}),F=new Nexus.Dial("#comp_knee",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:40,step:1,value:30}),j=new Nexus.Dial("#comp_ratio",{size:[50,50],interaction:"radial",mode:"relative",min:1,max:20,step:1,value:12}),Z=new Nexus.Dial("#comp_reduction",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:0,step:1,value:0}),J=new Nexus.Dial("#comp_attack",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.01,value:.003}),k=new Nexus.Dial("#comp_release",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.05,value:.25}),T=new Nexus.Toggle("#comp_bypass");new Nexus.Dial("#reverb",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:10});new Nexus.Toggle("#rev_bypass");var ee=new Nexus.Toggle("#eq_bypass"),R=new Nexus.Select("eq_type",{size:[200,20],options:["lowshelf","highshelf"]}),O=new Nexus.Slider("eq_freq",{size:[120,20],mode:"relative",min:20,max:2e4,step:100,value:1e3}),U=new Nexus.Dial("#eq1",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq2",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq3",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});var ne=new Nexus.Toggle("#gain_bypass"),D=new Nexus.Dial("#gain",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:2}),te=new Nexus.Toggle("#pan_bypass"),P=new Nexus.Dial("#pan",{size:[50,50],interaction:"radial",mode:"relative",min:-1,max:1,step:.1,value:0});const we=document.getElementById("remoteVideo"),_=document.getElementById("audioSource"),B=document.getElementById("audioOutput"),$=[_,B];function xe(a){const c=$.map(n=>n.value);$.forEach(n=>{for(;n.firstChild;)n.removeChild(n.firstChild)});for(let n=0;n!==a.length;++n){const o=a[n],e=document.createElement("option");e.value=o.deviceId,o.kind==="audioinput"?(e.text=o.label||`microphone ${_.length+1}`,_.appendChild(e)):o.kind==="audiooutput"&&(e.text=o.label||`speaker ${B.length+1}`,B.appendChild(e))}$.forEach((n,o)=>{Array.prototype.slice.call(n.childNodes).some(e=>e.value===c[o])&&(n.value=c[o])})}navigator.mediaDevices.enumerateDevices().then(xe).catch(console.log("media query success"));function Se(){const a=B.value;we.setSinkId(a).then(console.log("success"))}function ae(){return{audio:{deviceId:_.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var oe=ae();_.addEventListener("change",function(){oe=ae()});B.onchange=Se;V.onclick=async()=>{w=await navigator.mediaDevices.getUserMedia(oe),G=new MediaStream,w.getTracks().forEach(a=>{l.addTrack(a,w)}),l.ontrack=a=>{console.log("case2"),a.streams[0].getTracks().forEach(c=>{console.log(c),G.addTrack(c)})},W.srcObject=G,S.play(),W.play(),E.disabled=!1,z.disabled=!1,V.disabled=!0};const H=document.getElementById("muteMonitor");H.checked==!0?S.muted=!0:S.muted=!1;H.addEventListener("change",function(){H.checked==!0?(S.muted=!0,console.log("monitor muted")):(S.muted=!1,console.log("monitor unmuted"))});const K=document.getElementById("muteMe");K.checked=!1;K.addEventListener("change",function(){K.checked==!0?(w.getTracks()[0].enabled=!1,console.log("muted me")):(w.getTracks()[0].enabled=!0,console.log("unmuted me"))});const u=re();E.onclick=async()=>{let a=document.createTextNode("You created a call.");Q.appendChild(a),E.disabled=!0,z.disabled=!0;const c=y(u,"calls1"),n=await L(c,{});Y.value=n.id;const o=y(u,"calls1",n.id,"offerCandidates"),e=y(u,"calls1",n.id,"answerCandidates");l.onicecandidate=s=>{s.candidate&&L(o,s.candidate.toJSON())};const t=await l.createOffer();t.sdp=t.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await l.setLocalDescription(t),console.log("offerdescription from pa",t);const r={sdp:t.sdp,type:t.type};await de(C(u,"calls1",n.id),{offer:r}),console.log("offer from pa",r);const m=N(C(u,"calls1",n.id));I(m,s=>{const p=s.data();if(!l.currentRemoteDescription&&(p==null?void 0:p.answer)){const d=new RTCSessionDescription(p.answer);l.setRemoteDescription(d),console.log("answerdescription from pa",d)}});const b=N(e);I(b,s=>{s.docChanges().forEach(p=>{if(p.type==="added"){const d=new RTCIceCandidate(p.doc.data());l.addIceCandidate(d),console.log("candidate from pa",d)}})}),fe.disabled=!1};z.onclick=async()=>{let a=document.createTextNode("You answered a call!");Q.appendChild(a),E.disabled=!0,z.disabled=!0;const c=Y.value,n=y(u,"calls1"),o=y(u,"calls1",c,"answerCandidates"),e=y(u,"calls1",c,"offerCandidates");l.onicecandidate=d=>{d.candidate&&L(o,d.candidate.toJSON())};const t=(await ue(C(n,c))).data();console.log(t);const r=t.offer;await l.setRemoteDescription(new RTCSessionDescription(r));const m=await l.createAnswer();m.sdp=m.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await l.setLocalDescription(m),console.log("answerDescription from pb",m);const b={type:m.type,sdp:m.sdp};await f(C(u,"calls1",c),{answer:b}),console.log("answer from pb",b);const s=N(e);I(s,d=>{d.docChanges().forEach(i=>{if(i.type==="added"){let le=i.doc.data();l.addIceCandidate(new RTCIceCandidate(le))}})});const p=N(C(u,"fxValues","comp"));I(p,d=>{const i=d.data();i.comp_threshold&&(Compressor.threshold.value=i.comp_threshold),i.comp_release&&(Compressor.release.value=i.comp_release),i.comp_attack&&(Compressor.attack.value=i.comp_attack),i.comp_knee&&(Compressor.knee.value=i.comp_knee),i.comp_ratio&&(Compressor.ratio.value=i.comp_ratio),i.comp_bypass&&(T=i.comp_bypass,T.state==!0?(Compressor.disconnect(),source.connect(biquadFilter),biquadFilter.connect(Gainner),Gainner.connect(Panner),Panner.connect(audioCtx.destination)):(source.connect(Compressor),Compressor.connect(biquadFilter),biquadFilter.connect(Gainner),Gainner.connect(Panner),Panner.connect(audioCtx.destination))),console.log(i.comp_threshold)})};ge.onclick=async()=>{console.log("button has been pushed");var a=new AudioContext,c=a.createMediaStreamSource(w),n=a.createBiquadFilter();n.type=R.value,n.frequency.value=O.value,n.gain.value=D.value;var o=a.createStereoPanner();o.pan.value=P.value;var e=a.createGain();e.gain.value=D.value;var t=a.createDynamicsCompressor();t.release.value=k.value,c.connect(t),t.connect(n),n.connect(e),e.connect(o),o.connect(a.destination);const r=C(u,"fxValues","comp");M.on("change",function(s){t.threshold.value=M.value,f(r,{comp_threshold:M.value}),console.log(M.value)}),k.on("change",function(s){t.release.value=k.value,f(r,{comp_release:k.value}),console.log(k.value)}),J.on("change",function(s){t.attack.value=J.value,f(r,{comp_attack:J.value})}),F.on("change",function(s){t.knee.value=F.value,f(r,{comp_knee:F.value})}),j.on("change",function(s){t.ratio.value=j.value,f(r,{comp_ratio:j.value})}),Z.on("change",function(s){f(r,{comp_reduction:Z.value})}),R.on("change",function(s){n.type=R.value,console.log(R.value)}),O.on("change",function(s){n.frequency.value=O.value,console.log(O)}),U.on("change",function(s){n.gain.value=U.value,console.log(U.value)}),P.on("change",function(s){o.pan.value=P.value,console.log(P.value)}),D.on("change",function(s){e.gain.value=D.value,console.log(D.value)}),T.on("change",function(s){T.state==!0?(t.disconnect(),c.connect(n),n.connect(e),e.connect(o),o.connect(a.destination)):(c.connect(t),t.connect(n),n.connect(e),e.connect(o),o.connect(a.destination))}),ee.on("change",function(s){ee.state==!0?(n.disconnect(),c.connect(t),t.connect(e),e.connect(o),o.connect(a.destination)):(c.connect(t),t.connect(n),n.connect(e),e.connect(o),o.connect(a.destination))}),ne.on("change",function(s){ne.state==!0?(e.disconnect(),c.connect(t),t.connect(n),n.connect(o),o.connect(a.destination)):(c.connect(t),t.connect(n),n.connect(e),e.connect(o),o.connect(a.destination))}),te.on("change",function(s){te.state==!0?(o.disconnect(),c.connect(t),t.connect(n),n.connect(e),e.connect(a.destination)):(c.connect(t),t.connect(n),n.connect(e),e.connect(o),o.connect(a.destination))});var m=new Nexus.Oscilloscope("#oScope");m.connect(c);var b=new Nexus.Spectrogram("#spec");b.connect(c)};function ke(){h.placeholder="",console.log("Created local peer connection object localConnection"),v=l.createDataChannel("sendDataChannel"),console.log("Created send data channel"),console.log(v),v.onopen=ce,v.onclose=ce,l.ondatachannel=Be,A.disabled=!0,x.disabled=!1}function De(){const a=h.value;v.send(a),console.log("Sent Data: "+a)}function _e(){console.log("Closing data channels"),v.close(),console.log("Closed data channel with label: "+v.label),g.close(),console.log("Closed data channel with label: "+g.label),l.close(),l=null,console.log("Closed peer connections"),A.disabled=!1,q.disabled=!0,x.disabled=!0,h.value="",dataChannelReceive.value="",h.disabled=!0,disableSendButton(),enableStartButton()}function Be(a){console.log("Receive Channel Callback"),g=a.channel,g.onmessage=Ne,g.onopen=se,g.onclose=se}function Ne(a){console.log("Received Message"),dataChannelReceive.value=a.data}function ce(){const a=v.readyState;console.log("Send channel state is: "+a),a==="open"?(h.disabled=!1,h.focus(),q.disabled=!1,x.disabled=!1):(h.disabled=!0,q.disabled=!0,x.disabled=!0)}function se(){const a=g.readyState;console.log(`Receive channel state is: ${a}`)}
