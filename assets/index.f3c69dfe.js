import{i as ne,B as ae,S as h,E as j,y as oe,C as g,q as w,I as _,l as ce,p as r}from"./vendor.e711fc39.js";const ie=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=t(e);fetch(e.href,n)}};ie();const se={apiKey:"AIzaSyBLAS9TSpc8v-273koNVal1Tt1jes7lAQQ",authDomain:"webcodec-64053.firebaseapp.com",projectId:"webcodec-64053",storageBucket:"webcodec-64053.appspot.com",messagingSenderId:"499852745372",appId:"1:499852745372:web:c5d05223a82e7e26c86b59",measurementId:"G-TY670YZV22"};ne(se);const le={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},p=new RTCPeerConnection(le);let b=null,G=null;const Y=document.getElementById("webcamButton"),q=document.getElementById("webcamVideo"),I=document.getElementById("callButton"),$=document.getElementById("callInput"),E=document.getElementById("answerButton"),U=document.getElementById("remoteVideo"),re=document.getElementById("hangupButton"),de=document.getElementById("testButton"),Z=document.getElementById("callMessage");Nexus.colors.accent="#2596be";Nexus.colors.fill="#333";var ue=new Nexus.Toggle("#muteMo",{state:!0});ue.on("change",function(c){document.getElementById("muteMonitor").click()});var pe=new Nexus.Toggle("#muteMy");pe.on("change",function(c){document.getElementById("muteMe").click()});var me=new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});me.colorize("fill","#eee");var fe=new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});fe.colorize("fill","#eee");var H=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});H.colorize("fill","#eee");H.on("change",function(c){Y.click()});var T=new Nexus.Dial("#comp_threshold",{size:[50,50],interaction:"radial",mode:"relative",min:-100,max:0,step:1,value:-24}),z=new Nexus.Dial("#comp_knee",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:40,step:1,value:30}),M=new Nexus.Dial("#comp_ratio",{size:[50,50],interaction:"radial",mode:"relative",min:1,max:20,step:1,value:12}),F=new Nexus.Dial("#comp_reduction",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:0,step:1,value:0}),V=new Nexus.Dial("#comp_attack",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.01,value:.003}),S=new Nexus.Dial("#comp_release",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.05,value:.25}),O=new Nexus.Toggle("#comp_bypass");new Nexus.Dial("#reverb",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:10});new Nexus.Toggle("#rev_bypass");var L=new Nexus.Toggle("#eq_bypass"),D=new Nexus.Select("eq_type",{size:[200,20],options:["lowshelf","highshelf"]}),k=new Nexus.Slider("eq_freq",{size:[120,20],mode:"relative",min:20,max:2e4,step:100,value:1e3}),A=new Nexus.Dial("#eq1",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq2",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq3",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});var R=new Nexus.Toggle("#gain_bypass"),x=new Nexus.Dial("#gain",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:2}),P=new Nexus.Toggle("#pan_bypass"),C=new Nexus.Dial("#pan",{size:[50,50],interaction:"radial",mode:"relative",min:-1,max:1,step:.1,value:0});const ve=document.getElementById("remoteVideo"),N=document.getElementById("audioSource"),B=document.getElementById("audioOutput"),J=[N,B];function ge(c){const i=J.map(t=>t.value);J.forEach(t=>{for(;t.firstChild;)t.removeChild(t.firstChild)});for(let t=0;t!==c.length;++t){const o=c[t],e=document.createElement("option");e.value=o.deviceId,o.kind==="audioinput"?(e.text=o.label||`microphone ${N.length+1}`,N.appendChild(e)):o.kind==="audiooutput"&&(e.text=o.label||`speaker ${B.length+1}`,B.appendChild(e))}J.forEach((t,o)=>{Array.prototype.slice.call(t.childNodes).some(e=>e.value===i[o])&&(t.value=i[o])})}navigator.mediaDevices.enumerateDevices().then(ge).catch(console.log("media query success"));function ye(){const c=B.value;ve.setSinkId(c).then(console.log("success"))}function W(){return{audio:{deviceId:N.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var X=W();N.addEventListener("change",function(){X=W()});B.onchange=ye;Y.onclick=async()=>{b=await navigator.mediaDevices.getUserMedia(X),G=new MediaStream,b.getTracks().forEach(c=>{p.addTrack(c,b)}),p.ontrack=c=>{console.log("case2"),c.streams[0].getTracks().forEach(i=>{console.log(i),G.addTrack(i)})},U.srcObject=G,q.play(),U.play(),I.disabled=!1,E.disabled=!1,Y.disabled=!0};const K=document.getElementById("muteMonitor");K.checked==!0?q.muted=!0:q.muted=!1;K.addEventListener("change",function(){K.checked==!0?(q.muted=!0,console.log("monitor muted")):(q.muted=!1,console.log("monitor unmuted"))});const Q=document.getElementById("muteMe");Q.checked=!1;Q.addEventListener("change",function(){Q.checked==!0?(b.getTracks()[0].enabled=!1,console.log("muted me")):(b.getTracks()[0].enabled=!0,console.log("unmuted me"))});const d=ae();I.onclick=async()=>{let c=document.createTextNode("You created a call.");Z.appendChild(c),I.disabled=!0,E.disabled=!0;const i=h(d,"calls1"),t=await j(i,{});$.value=t.id;const o=h(d,"calls1",t.id,"offerCandidates"),e=h(d,"calls1",t.id,"answerCandidates");p.onicecandidate=f=>{f.candidate&&j(o,f.candidate.toJSON())};const n=await p.createOffer();n.sdp=n.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await p.setLocalDescription(n),console.log("offerdescription from pa",n);const l={sdp:n.sdp,type:n.type};await oe(g(d,"calls1",t.id),{offer:l}),console.log("offer from pa",l);const u=w(g(d,"calls1",t.id));_(u,f=>{const m=f.data();if(!p.currentRemoteDescription&&(m==null?void 0:m.answer)){const s=new RTCSessionDescription(m.answer);p.setRemoteDescription(s),console.log("answerdescription from pa",s)}});const y=w(e);_(y,f=>{f.docChanges().forEach(m=>{if(m.type==="added"){const s=new RTCIceCandidate(m.doc.data());p.addIceCandidate(s),console.log("candidate from pa",s)}})}),re.disabled=!1};E.onclick=async()=>{let c=document.createTextNode("You answered a call!");Z.appendChild(c),I.disabled=!0,E.disabled=!0;const i=$.value,t=h(d,"calls1"),o=h(d,"calls1",i,"answerCandidates"),e=h(d,"calls1",i,"offerCandidates");p.onicecandidate=v=>{v.candidate&&j(o,v.candidate.toJSON())};const n=(await ce(g(t,i))).data();console.log(n);const l=n.offer;await p.setRemoteDescription(new RTCSessionDescription(l));const u=await p.createAnswer();u.sdp=u.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await p.setLocalDescription(u),console.log("answerDescription from pb",u);const y={type:u.type,sdp:u.sdp};await r(g(d,"calls1",i),{answer:y}),console.log("answer from pb",y);const f=w(e);_(f,v=>{v.docChanges().forEach(a=>{if(a.type==="added"){let te=a.doc.data();p.addIceCandidate(new RTCIceCandidate(te))}})});const m=w(g(d,"fxValues","comp"));_(m,v=>{const a=v.data();typeof a.comp_threshold!="undefined"&&(T.value=a.comp_threshold),typeof a.comp_release!="undefined"&&(S.value=a.comp_release),typeof a.comp_attack!="undefined"&&(V.value=a.comp_attack),typeof a.comp_knee!="undefined"&&(z.value=a.comp_knee),typeof a.comp_ratio!="undefined"&&(M.value=a.comp_ratio),typeof a.comp_reduction!="undefined"&&(F.value=a.comp_reduction),typeof a.comp_bypass!="undefined"&&(O.state=a.comp_bypass),console.log(a.comp_threshold)});const s=w(g(d,"fxValues","eq"));_(s,v=>{const a=v.data();typeof a.eq_type!="undefined"&&(D.value=a.eq_type),typeof a.eq_freq!="undefined"&&(k.value=a.eq_freq),typeof a.eq1!="undefined"&&(A.value=a.eq1),typeof a.eq_bypass!="undefined"&&(L.state=a.eq_bypass)});const ee=w(g(d,"fxValues","other"));_(ee,v=>{const a=v.data();typeof a.pan!="undefined"&&(C.value=a.pan),typeof a.gain!="undefined"&&(x.value=a.gain),typeof a.gain_bypass!="undefined"&&(R.state=a.gain_bypass),typeof a.pan_bypass!="undefined"&&(P.state=a.pan_bypass)})};de.onclick=async()=>{console.log("button has been pushed");var c=new AudioContext,i=c.createMediaStreamSource(b),t=c.createBiquadFilter();t.type=D.value,t.frequency.value=k.value,t.gain.value=x.value;var o=c.createStereoPanner();o.pan.value=C.value;var e=c.createGain();e.gain.value=x.value;var n=c.createDynamicsCompressor();n.release.value=S.value,i.connect(n),n.connect(t),t.connect(e),e.connect(o),o.connect(c.destination);const l=g(d,"fxValues","comp"),u=g(d,"fxValues","eq"),y=g(d,"fxValues","other");T.on("change",function(s){n.threshold.value=T.value,r(l,{comp_threshold:T.value})}),S.on("change",function(s){n.release.value=S.value,r(l,{comp_release:S.value})}),V.on("change",function(s){n.attack.value=V.value,r(l,{comp_attack:V.value})}),z.on("change",function(s){n.knee.value=z.value,r(l,{comp_knee:z.value})}),M.on("change",function(s){n.ratio.value=M.value,r(l,{comp_ratio:M.value})}),F.on("change",function(s){r(l,{comp_reduction:F.value})}),D.on("change",function(s){t.type=D.value,r(u,{eq_type:D.value})}),k.on("change",function(s){t.frequency.value=k.value,r(u,{eq_freq:k.value})}),A.on("change",function(s){t.gain.value=A.value,r(u,{eq1:A.value})}),C.on("change",function(s){o.pan.value=C.value,r(y,{pan:C.value})}),x.on("change",function(s){e.gain.value=x.value,r(y,{gain:x.value})}),O.on("change",function(s){r(l,{comp_bypass:O.state}),O.state==!0?(n.disconnect(),i.connect(t),t.connect(e),e.connect(o),o.connect(c.destination)):(i.connect(n),n.connect(t),t.connect(e),e.connect(o),o.connect(c.destination))}),L.on("change",function(s){r(u,{eq_bypass:L.state}),L.state==!0?(t.disconnect(),i.connect(n),n.connect(e),e.connect(o),o.connect(c.destination)):(i.connect(n),n.connect(t),t.connect(e),e.connect(o),o.connect(c.destination))}),R.on("change",function(s){r(y,{gain_bypass:R.state}),R.state==!0?(e.disconnect(),i.connect(n),n.connect(t),t.connect(o),o.connect(c.destination)):(i.connect(n),n.connect(t),t.connect(e),e.connect(o),o.connect(c.destination))}),P.on("change",function(s){r(y,{pan_bypass:P.state}),P.state==!0?(o.disconnect(),i.connect(n),n.connect(t),t.connect(e),e.connect(c.destination)):(i.connect(n),n.connect(t),t.connect(e),e.connect(o),o.connect(c.destination))});var f=new Nexus.Oscilloscope("#oScope");f.connect(i);var m=new Nexus.Spectrogram("#spec");m.connect(i)};
