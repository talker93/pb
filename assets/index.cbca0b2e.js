import{i as te,B as ae,S as y,E as G,y as oe,C as g,q as w,I as _,l as ce,p as d}from"./vendor.e711fc39.js";const ie=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?t.credentials="include":e.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=n(e);fetch(e.href,t)}};ie();const se={apiKey:"AIzaSyBLAS9TSpc8v-273koNVal1Tt1jes7lAQQ",authDomain:"webcodec-64053.firebaseapp.com",projectId:"webcodec-64053",storageBucket:"webcodec-64053.appspot.com",messagingSenderId:"499852745372",appId:"1:499852745372:web:c5d05223a82e7e26c86b59",measurementId:"G-TY670YZV22"};te(se);const le={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},l=new RTCPeerConnection(le);let b=null,j=null;ye();const Y=document.getElementById("webcamButton"),q=document.getElementById("webcamVideo"),I=document.getElementById("callButton"),$=document.getElementById("callInput"),E=document.getElementById("answerButton"),U=document.getElementById("remoteVideo"),re=document.getElementById("hangupButton"),de=document.getElementById("testButton"),Z=document.getElementById("callMessage");Nexus.colors.accent="#2596be";Nexus.colors.fill="#333";var ue=new Nexus.Toggle("#muteMo",{state:!0});ue.on("change",function(o){document.getElementById("muteMonitor").click()});var pe=new Nexus.Toggle("#muteMy");pe.on("change",function(o){document.getElementById("muteMe").click()});var me=new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});me.colorize("fill","#eee");var fe=new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});fe.colorize("fill","#eee");var H=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});H.colorize("fill","#eee");H.on("change",function(o){Y.click()});var T=new Nexus.Dial("#comp_threshold",{size:[50,50],interaction:"radial",mode:"relative",min:-100,max:0,step:1,value:-24}),z=new Nexus.Dial("#comp_knee",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:40,step:1,value:30}),M=new Nexus.Dial("#comp_ratio",{size:[50,50],interaction:"radial",mode:"relative",min:1,max:20,step:1,value:12}),F=new Nexus.Dial("#comp_reduction",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:0,step:1,value:0}),V=new Nexus.Dial("#comp_attack",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.01,value:.003}),S=new Nexus.Dial("#comp_release",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.05,value:.25}),O=new Nexus.Toggle("#comp_bypass");new Nexus.Dial("#reverb",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:10});new Nexus.Toggle("#rev_bypass");var L=new Nexus.Toggle("#eq_bypass"),k=new Nexus.Select("eq_type",{size:[200,20],options:["lowshelf","highshelf"]}),C=new Nexus.Slider("eq_freq",{size:[120,20],mode:"relative",min:20,max:2e4,step:100,value:1e3}),A=new Nexus.Dial("#eq1",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq2",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});new Nexus.Dial("#eq3",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10});var R=new Nexus.Toggle("#gain_bypass"),x=new Nexus.Dial("#gain",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:2}),P=new Nexus.Toggle("#pan_bypass"),D=new Nexus.Dial("#pan",{size:[50,50],interaction:"radial",mode:"relative",min:-1,max:1,step:.1,value:0});const ve=document.getElementById("remoteVideo"),N=document.getElementById("audioSource"),B=document.getElementById("audioOutput"),J=[N,B];function ge(o){const i=J.map(n=>n.value);J.forEach(n=>{for(;n.firstChild;)n.removeChild(n.firstChild)});for(let n=0;n!==o.length;++n){const c=o[n],e=document.createElement("option");e.value=c.deviceId,c.kind==="audioinput"?(e.text=c.label||`microphone ${N.length+1}`,N.appendChild(e)):c.kind==="audiooutput"&&(e.text=c.label||`speaker ${B.length+1}`,B.appendChild(e))}J.forEach((n,c)=>{Array.prototype.slice.call(n.childNodes).some(e=>e.value===i[c])&&(n.value=i[c])})}navigator.mediaDevices.enumerateDevices().then(ge).catch(console.log("media query success"));function he(){const o=B.value;ve.setSinkId(o).then(console.log("success"))}function W(){return{audio:{deviceId:N.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var X=W();N.addEventListener("change",function(){X=W()});B.onchange=he;Y.onclick=async()=>{b=await navigator.mediaDevices.getUserMedia(X),j=new MediaStream,b.getTracks().forEach(o=>{l.addTrack(o,b)}),l.ontrack=o=>{console.log("case2"),o.streams[0].getTracks().forEach(i=>{console.log(i),j.addTrack(i)})},U.srcObject=j,q.play(),U.play(),I.disabled=!1,E.disabled=!1,Y.disabled=!0};const K=document.getElementById("muteMonitor");K.checked==!0?q.muted=!0:q.muted=!1;K.addEventListener("change",function(){K.checked==!0?(q.muted=!0,console.log("monitor muted")):(q.muted=!1,console.log("monitor unmuted"))});const Q=document.getElementById("muteMe");Q.checked=!1;Q.addEventListener("change",function(){Q.checked==!0?(b.getTracks()[0].enabled=!1,console.log("muted me")):(b.getTracks()[0].enabled=!0,console.log("unmuted me"))});const u=ae();I.onclick=async()=>{let o=document.createTextNode("You created a call.");Z.appendChild(o),I.disabled=!0,E.disabled=!0;const i=y(u,"calls1"),n=await G(i,{});$.value=n.id;const c=y(u,"calls1",n.id,"offerCandidates"),e=y(u,"calls1",n.id,"answerCandidates");l.onicecandidate=f=>{f.candidate&&G(c,f.candidate.toJSON())};const t=await l.createOffer();t.sdp=t.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await l.setLocalDescription(t),console.log("offerdescription from pa",t);const r={sdp:t.sdp,type:t.type};await oe(g(u,"calls1",n.id),{offer:r}),console.log("offer from pa",r);const p=w(g(u,"calls1",n.id));_(p,f=>{const m=f.data();if(!l.currentRemoteDescription&&(m==null?void 0:m.answer)){const s=new RTCSessionDescription(m.answer);l.setRemoteDescription(s),console.log("answerdescription from pa",s)}});const h=w(e);_(h,f=>{f.docChanges().forEach(m=>{if(m.type==="added"){const s=new RTCIceCandidate(m.doc.data());l.addIceCandidate(s),console.log("candidate from pa",s)}})}),re.disabled=!1};E.onclick=async()=>{let o=document.createTextNode("You answered a call!");Z.appendChild(o),I.disabled=!0,E.disabled=!0;const i=$.value,n=y(u,"calls1"),c=y(u,"calls1",i,"answerCandidates"),e=y(u,"calls1",i,"offerCandidates");l.onicecandidate=v=>{v.candidate&&G(c,v.candidate.toJSON())};const t=(await ce(g(n,i))).data();console.log(t);const r=t.offer;await l.setRemoteDescription(new RTCSessionDescription(r));const p=await l.createAnswer();p.sdp=p.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await l.setLocalDescription(p),console.log("answerDescription from pb",p);const h={type:p.type,sdp:p.sdp};await d(g(u,"calls1",i),{answer:h}),console.log("answer from pb",h);const f=w(e);_(f,v=>{v.docChanges().forEach(a=>{if(a.type==="added"){let ne=a.doc.data();l.addIceCandidate(new RTCIceCandidate(ne))}})});const m=w(g(u,"fxValues","comp"));_(m,v=>{const a=v.data();typeof a.comp_threshold!="undefined"&&(T.value=a.comp_threshold),typeof a.comp_release!="undefined"&&(S.value=a.comp_release),typeof a.comp_attack!="undefined"&&(V.value=a.comp_attack),typeof a.comp_knee!="undefined"&&(z.value=a.comp_knee),typeof a.comp_ratio!="undefined"&&(M.value=a.comp_ratio),typeof a.comp_reduction!="undefined"&&(F.value=a.comp_reduction),typeof a.comp_bypass!="undefined"&&(O.state=a.comp_bypass),console.log(a.comp_threshold)});const s=w(g(u,"fxValues","eq"));_(s,v=>{const a=v.data();typeof a.eq_type!="undefined"&&(k.value=a.eq_type),typeof a.eq_freq!="undefined"&&(C.value=a.eq_freq),typeof a.eq1!="undefined"&&(A.value=a.eq1),typeof a.eq_bypass!="undefined"&&(L.state=a.eq_bypass)});const ee=w(g(u,"fxValues","other"));_(ee,v=>{const a=v.data();typeof a.pan!="undefined"&&(D.value=a.pan),typeof a.gain!="undefined"&&(x.value=a.gain),typeof a.gain_bypass!="undefined"&&(R.state=a.gain_bypass),typeof a.pan_bypass!="undefined"&&(P.state=a.pan_bypass)})};de.onclick=async()=>{console.log("button has been pushed");var o=new AudioContext,i=o.createMediaStreamSource(b),n=o.createBiquadFilter();n.type=k.value,n.frequency.value=C.value,n.gain.value=x.value;var c=o.createStereoPanner();c.pan.value=D.value;var e=o.createGain();e.gain.value=x.value;var t=o.createDynamicsCompressor();t.release.value=S.value,i.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination);const r=g(u,"fxValues","comp"),p=g(u,"fxValues","eq"),h=g(u,"fxValues","other");T.on("change",function(s){t.threshold.value=T.value,d(r,{comp_threshold:T.value})}),S.on("change",function(s){t.release.value=S.value,d(r,{comp_release:S.value})}),V.on("change",function(s){t.attack.value=V.value,d(r,{comp_attack:V.value})}),z.on("change",function(s){t.knee.value=z.value,d(r,{comp_knee:z.value})}),M.on("change",function(s){t.ratio.value=M.value,d(r,{comp_ratio:M.value})}),F.on("change",function(s){d(r,{comp_reduction:F.value})}),k.on("change",function(s){n.type=k.value,d(p,{eq_type:k.value})}),C.on("change",function(s){n.frequency.value=C.value,d(p,{eq_freq:C.value})}),A.on("change",function(s){n.gain.value=A.value,d(p,{eq1:A.value})}),D.on("change",function(s){c.pan.value=D.value,d(h,{pan:D.value})}),x.on("change",function(s){e.gain.value=x.value,d(h,{gain:x.value})}),O.on("change",function(s){d(r,{comp_bypass:O.state}),O.state==!0?(t.disconnect(),i.connect(n),n.connect(e),e.connect(c),c.connect(o.destination)):(i.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))}),L.on("change",function(s){d(p,{eq_bypass:L.state}),L.state==!0?(n.disconnect(),i.connect(t),t.connect(e),e.connect(c),c.connect(o.destination)):(i.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))}),R.on("change",function(s){d(h,{gain_bypass:R.state}),R.state==!0?(e.disconnect(),i.connect(t),t.connect(n),n.connect(c),c.connect(o.destination)):(i.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))}),P.on("change",function(s){d(h,{pan_bypass:P.state}),P.state==!0?(c.disconnect(),i.connect(t),t.connect(n),n.connect(e),e.connect(o.destination)):(i.connect(t),t.connect(n),n.connect(e),e.connect(c),c.connect(o.destination))});var f=new Nexus.Oscilloscope("#oScope");f.connect(i);var m=new Nexus.Spectrogram("#spec");m.connect(i)};function ye(){l.onconnectionstatechange=o=>{console.log("connection state: ",l.connectionState)},l.oniceconnectionstatechange=o=>{console.log("ice connection state: ",l.iceConnectionState)},l.oniceconnectionstatechange=o=>{console.log("ice gathering state: ",l.iceGatheringState)}}
