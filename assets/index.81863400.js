import{i as q,B as A,S as m,E as C,y as N,C as b,q as v,I,l as V,p as j}from"./vendor.e711fc39.js";const z=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?a.credentials="include":e.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(e){if(e.ep)return;e.ep=!0;const a=o(e);fetch(e.href,a)}};z();const G={apiKey:"AIzaSyB7Jkv647eebeqifG6mAHv40fUyfdDRB8k",authDomain:"fireship-demos-ce28a.firebaseapp.com",databaseURL:"https://fireship-demos-ce28a-default-rtdb.firebaseio.com",projectId:"fireship-demos-ce28a",storageBucket:"fireship-demos-ce28a.appspot.com",messagingSenderId:"710932691797",appId:"1:710932691797:web:5838b9fd459ba264af4ddc",measurementId:"G-FNWH5RC87G"};q(G);const P={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},c=new RTCPeerConnection(P);let f=null,w=null;const D=document.getElementById("webcamButton"),p=document.getElementById("webcamVideo"),S=document.getElementById("callButton"),R=document.getElementById("callInput"),T=document.getElementById("answerButton"),x=document.getElementById("remoteVideo"),J=document.getElementById("hangupButton"),U=document.getElementById("testButton"),F=document.getElementById("remoteVideo"),g=document.getElementById("audioSource"),h=document.getElementById("audioOutput"),B=[g,h];function H(n){const t=B.map(o=>o.value);B.forEach(o=>{for(;o.firstChild;)o.removeChild(o.firstChild)});for(let o=0;o!==n.length;++o){const s=n[o],e=document.createElement("option");e.value=s.deviceId,s.kind==="audioinput"?(e.text=s.label||`microphone ${g.length+1}`,g.appendChild(e)):s.kind==="audiooutput"&&(e.text=s.label||`speaker ${h.length+1}`,h.appendChild(e))}B.forEach((o,s)=>{Array.prototype.slice.call(o.childNodes).some(e=>e.value===t[s])&&(o.value=t[s])})}navigator.mediaDevices.enumerateDevices().then(H).catch(console.log("media query success"));function K(){const n=h.value;F.setSinkId(n).then(console.log("success"))}function O(){return{audio:{deviceId:g.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var L=O();g.addEventListener("change",function(){L=O()});h.onchange=K;D.onclick=async()=>{f=await navigator.mediaDevices.getUserMedia(L),w=new MediaStream,f.getTracks().forEach(n=>{console.log("case1"),c.addTrack(n,f)}),c.ontrack=n=>{console.log("case2"),n.streams[0].getTracks().forEach(t=>{console.log(t),w.addTrack(t)})},p.srcObject=f,x.srcObject=w,S.disabled=!1,T.disabled=!1,D.disabled=!0};const E=document.getElementById("muteMonitor");E.checked==!0?p.muted=!0:p.muted=!1;E.addEventListener("change",function(){E.checked==!0?(p.muted=!0,console.log("monitor muted")):(p.muted=!1,console.log("monitor unmuted"))});const k=document.getElementById("muteMe");k.checked=!1;k.addEventListener("change",function(){k.checked==!0?(f.getTracks()[0].enabled=!1,console.log("muted me")):(f.getTracks()[0].enabled=!0,console.log("unmuted me"))});const l=A();S.onclick=async()=>{const n=m(l,"calls1"),t=await C(n,{});R.value=t.id;const o=m(l,"calls1",t.id,"offerCandidates"),s=m(l,"calls1",t.id,"answerCandidates");c.onicecandidate=r=>{r.candidate&&C(o,r.candidate.toJSON())};const e=await c.createOffer();e.sdp=e.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await c.setLocalDescription(e),console.log("offerdescription from pa",e);const a={sdp:e.sdp,type:e.type};await N(b(l,"calls1",t.id),{offer:a}),console.log("offer from pa",a);const i=v(b(l,"calls1",t.id));I(i,r=>{const d=r.data();if(!c.currentRemoteDescription&&(d==null?void 0:d.answer)){const u=new RTCSessionDescription(d.answer);c.setRemoteDescription(u),console.log("answerdescription from pa",u)}});const y=v(s);I(y,r=>{r.docChanges().forEach(d=>{if(d.type==="added"){const u=new RTCIceCandidate(d.doc.data());c.addIceCandidate(u),console.log("candidate from pa",u)}})}),J.disabled=!1};T.onclick=async()=>{const n=R.value,t=m(l,"calls1"),o=m(l,"calls1",n,"answerCandidates"),s=m(l,"calls1",n,"offerCandidates");c.onicecandidate=d=>{d.candidate&&C(o,d.candidate.toJSON())};const e=(await V(b(t,n))).data();console.log(e);const a=e.offer;await c.setRemoteDescription(new RTCSessionDescription(a));const i=await c.createAnswer();i.sdp=i.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await c.setLocalDescription(i),console.log("answerDescription from pb",i);const y={type:i.type,sdp:i.sdp};await j(b(l,"calls1",n),{answer:y}),console.log("answer from pb",y);const r=v(s);I(r,d=>{d.docChanges().forEach(u=>{if(u.type==="added"){let M=u.doc.data();c.addIceCandidate(new RTCIceCandidate(M))}})})};U.onclick=async()=>{console.log("button has been pushed"),console.log(p.srcObject),console.log(f.getTracks()),console.log(w.getTracks())};
