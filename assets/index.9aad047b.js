import{i as P,B as V,S as p,E as C,y as z,C as y,q as B,I,l as F,p as G}from"./vendor.e711fc39.js";const j=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function t(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(e){if(e.ep)return;e.ep=!0;const o=t(e);fetch(e.href,o)}};j();const J={apiKey:"AIzaSyB7Jkv647eebeqifG6mAHv40fUyfdDRB8k",authDomain:"fireship-demos-ce28a.firebaseapp.com",databaseURL:"https://fireship-demos-ce28a-default-rtdb.firebaseio.com",projectId:"fireship-demos-ce28a",storageBucket:"fireship-demos-ce28a.appspot.com",messagingSenderId:"710932691797",appId:"1:710932691797:web:5838b9fd459ba264af4ddc",measurementId:"G-FNWH5RC87G"};P(J);const U={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},s=new RTCPeerConnection(U);let f=null,E=null;const k=document.getElementById("webcamButton"),g=document.getElementById("webcamVideo"),b=document.getElementById("callButton"),M=document.getElementById("callInput"),S=document.getElementById("answerButton"),T=document.getElementById("remoteVideo"),H=document.getElementById("hangupButton"),K=document.getElementById("testButton"),q=document.getElementById("callMessage");var R=new Nexus.Toggle("#muteMo");R.on("change",function(n){document.getElementById("muteMonitor").click()});new Nexus.Toggle("#muteMy");R.on("change",function(n){document.getElementById("muteMe").click()});new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});var Y=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});Y.on("change",function(n){k.click()});new Nexus.Envelope("#compressor");new Nexus.Slider("#reverb");new Nexus.Slider("#eq1");new Nexus.Slider("#eq2");new Nexus.Slider("#eq3");new Nexus.Slider("#gainValue");new Nexus.Slider("#panValue");const $=document.getElementById("remoteVideo"),h=document.getElementById("audioSource"),v=document.getElementById("audioOutput"),D=[h,v];function W(n){const a=D.map(t=>t.value);D.forEach(t=>{for(;t.firstChild;)t.removeChild(t.firstChild)});for(let t=0;t!==n.length;++t){const c=n[t],e=document.createElement("option");e.value=c.deviceId,c.kind==="audioinput"?(e.text=c.label||`microphone ${h.length+1}`,h.appendChild(e)):c.kind==="audiooutput"&&(e.text=c.label||`speaker ${v.length+1}`,v.appendChild(e))}D.forEach((t,c)=>{Array.prototype.slice.call(t.childNodes).some(e=>e.value===a[c])&&(t.value=a[c])})}navigator.mediaDevices.enumerateDevices().then(W).catch(console.log("media query success"));function Q(){const n=v.value;$.setSinkId(n).then(console.log("success"))}function O(){return{audio:{deviceId:h.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var L=O();h.addEventListener("change",function(){L=O()});v.onchange=Q;k.onclick=async()=>{f=await navigator.mediaDevices.getUserMedia(L),E=new MediaStream,f.getTracks().forEach(n=>{s.addTrack(n,f)}),s.ontrack=n=>{console.log("case2"),n.streams[0].getTracks().forEach(a=>{console.log(a),E.addTrack(a)})},T.srcObject=E,g.play(),T.play(),b.disabled=!1,S.disabled=!1,k.disabled=!0};const x=document.getElementById("muteMonitor");x.checked==!0?g.muted=!0:g.muted=!1;x.addEventListener("change",function(){x.checked==!0?(g.muted=!0,console.log("monitor muted")):(g.muted=!1,console.log("monitor unmuted"))});const N=document.getElementById("muteMe");N.checked=!1;N.addEventListener("change",function(){N.checked==!0?(f.getTracks()[0].enabled=!1,console.log("muted me")):(f.getTracks()[0].enabled=!0,console.log("unmuted me"))});const r=V();b.onclick=async()=>{let n=document.createTextNode("You created a call.");q.appendChild(n),b.disabled=!0,S.disabled=!0;const a=p(r,"calls1"),t=await C(a,{});M.value=t.id;const c=p(r,"calls1",t.id,"offerCandidates"),e=p(r,"calls1",t.id,"answerCandidates");s.onicecandidate=u=>{u.candidate&&C(c,u.candidate.toJSON())};const o=await s.createOffer();o.sdp=o.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await s.setLocalDescription(o),console.log("offerdescription from pa",o);const l={sdp:o.sdp,type:o.type};await z(y(r,"calls1",t.id),{offer:l}),console.log("offer from pa",l);const d=B(y(r,"calls1",t.id));I(d,u=>{const i=u.data();if(!s.currentRemoteDescription&&(i==null?void 0:i.answer)){const m=new RTCSessionDescription(i.answer);s.setRemoteDescription(m),console.log("answerdescription from pa",m)}});const w=B(e);I(w,u=>{u.docChanges().forEach(i=>{if(i.type==="added"){const m=new RTCIceCandidate(i.doc.data());s.addIceCandidate(m),console.log("candidate from pa",m)}})}),H.disabled=!1};S.onclick=async()=>{let n=document.createTextNode("You answered a call!");q.appendChild(n),b.disabled=!0,S.disabled=!0;const a=M.value,t=p(r,"calls1"),c=p(r,"calls1",a,"answerCandidates"),e=p(r,"calls1",a,"offerCandidates");s.onicecandidate=i=>{i.candidate&&C(c,i.candidate.toJSON())};const o=(await F(y(t,a))).data();console.log(o);const l=o.offer;await s.setRemoteDescription(new RTCSessionDescription(l));const d=await s.createAnswer();d.sdp=d.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await s.setLocalDescription(d),console.log("answerDescription from pb",d);const w={type:d.type,sdp:d.sdp};await G(y(r,"calls1",a),{answer:w}),console.log("answer from pb",w);const u=B(e);I(u,i=>{i.docChanges().forEach(m=>{if(m.type==="added"){let A=m.doc.data();s.addIceCandidate(new RTCIceCandidate(A))}})})};K.onclick=async()=>{console.log("button has been pushed");var n=document.querySelector("#gain"),a=document.querySelector("#pan"),t=new AudioContext,c=t.createMediaStreamSource(f),e=t.createBiquadFilter();e.type="lowshelf",e.frequency.value=1e3,e.gain.value=n.value;var o=t.createStereoPanner();o.pan.value=a.value,c.connect(e),e.connect(o),o.connect(t.destination),a.oninput=function(){o.pan.value=a.value},n.oninput=function(){e.gain.value=n.value};var l=new Nexus.Oscilloscope("#oScope");l.connect(c);var d=new Nexus.Spectrogram("#spec");d.connect(c)};
