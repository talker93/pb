import{i as se,B as ce,S as x,E as H,y as ie,C as G,q as K,I as Q,l as le,p as re}from"./vendor.e711fc39.js";const de=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function c(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=c(n);fetch(n.href,i)}};de();const ue={apiKey:"AIzaSyBLAS9TSpc8v-273koNVal1Tt1jes7lAQQ",authDomain:"webcodec-64053.firebaseapp.com",projectId:"webcodec-64053",storageBucket:"webcodec-64053.appspot.com",messagingSenderId:"499852745372",appId:"1:499852745372:web:c5d05223a82e7e26c86b59",measurementId:"G-TY670YZV22"};se(ue);const pe={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},m=new RTCPeerConnection(pe);let A=null,$=null,j=null,Z=0;Ce(m);const U=document.getElementById("webcamButton"),N=document.getElementById("webcamVideo"),F=document.getElementById("callButton"),W=document.getElementById("callInput"),Y=document.getElementById("answerButton"),ee=document.getElementById("remoteVideo"),fe=document.getElementById("hangupButton"),ae=document.getElementById("callMessage");let p,b,a=!1;Nexus.colors.accent="#2596be";Nexus.colors.fill="#333";var me=new Nexus.Toggle("#muteMo",{state:!0});me.on("change",function(s){document.getElementById("muteMonitor").click()});var ge=new Nexus.Toggle("#muteMy");ge.on("change",function(s){document.getElementById("muteMe").click()});var ve=new Nexus.Select("audioSourceSelect",{size:[200,20],options:["Default - MacBook Pro Microphone","iPhone"]});ve.colorize("fill","#eee");var he=new Nexus.Select("audioOutputSelect",{size:[200,20],options:["Defalut - MacBook Pro Speakers (Built-in)"]});he.colorize("fill","#eee");var ne=new Nexus.TextButton("#startDevices",{size:[150,50],state:!1,text:"Init",alternateText:"Activated"});ne.colorize("fill","#eee");ne.on("change",function(s){U.click()});var D=new Nexus.Dial("#comp_threshold",{size:[50,50],interaction:"radial",mode:"relative",min:-100,max:0,step:1,value:-24}),B=new Nexus.Dial("#comp_knee",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:40,step:1,value:30}),I=new Nexus.Dial("#comp_ratio",{size:[50,50],interaction:"radial",mode:"relative",min:1,max:20,step:1,value:12}),E=new Nexus.Dial("#comp_attack",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.01,value:.003}),k=new Nexus.Dial("#comp_release",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:1,step:.05,value:.25}),O=new Nexus.Toggle("#comp_bypass");new Nexus.Dial("#reverb",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:10});new Nexus.Toggle("#rev_bypass");var T=new Nexus.Toggle("#eq_bypass"),C=new Nexus.Select("eq_type",{size:[200,20],options:["lowshelf","highshelf"]}),q=new Nexus.Slider("eq_freq",{size:[120,20],mode:"relative",min:20,max:2e4,step:100,value:1e3}),M=new Nexus.Dial("#eq1",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10}),_=new Nexus.Dial("#eq2",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10}),z=new Nexus.Dial("#eq3",{size:[50,50],interaction:"radial",mode:"relative",min:-20,max:40,step:0,value:10}),J=new Nexus.Toggle("#gain_bypass"),y=new Nexus.Dial("#gain",{size:[50,50],interaction:"radial",mode:"relative",min:0,max:20,step:1,value:2}),P=new Nexus.Toggle("#pan_bypass"),S=new Nexus.Dial("#pan",{size:[50,50],interaction:"radial",mode:"relative",min:-1,max:1,step:.1,value:0}),e={comp:{attack:E.value,bypass:O.state,knee:B.value,ratio:I.value,release:k.value,threshold:D.value},eq:{low:M.value,mid:_.value,high:z.value,bypass:T.state,freq:q.value,type:C.value},pan:{bypass:P.state,pan:S.value},gain:{bypass:J.state,gain:y.value},whatChanged:"none"};const we=document.getElementById("remoteVideo"),L=document.getElementById("audioSource"),R=document.getElementById("audioOutput"),X=[L,R];function be(s){const r=X.map(c=>c.value);X.forEach(c=>{for(;c.firstChild;)c.removeChild(c.firstChild)});for(let c=0;c!==s.length;++c){const t=s[c],n=document.createElement("option");n.value=t.deviceId,t.kind==="audioinput"?(n.text=t.label||`microphone ${L.length+1}`,L.appendChild(n)):t.kind==="audiooutput"&&(n.text=t.label||`speaker ${R.length+1}`,R.appendChild(n))}X.forEach((c,t)=>{Array.prototype.slice.call(c.childNodes).some(n=>n.value===r[t])&&(c.value=r[t])})}navigator.mediaDevices.enumerateDevices().then(be).catch(console.log("media query success"));function ye(){const s=R.value;we.setSinkId(s).then(console.log("success"))}function te(){return{audio:{deviceId:L.value,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,latency:0,sampleRate:48e3,sampleSize:16,volume:1},video:!1}}var oe=te();L.addEventListener("change",function(){oe=te()});R.onchange=ye;U.onclick=async()=>{A=await navigator.mediaDevices.getUserMedia(oe),$=new MediaStream,await ke(),j.getTracks().forEach(c=>{m.addTrack(c,A)}),m.ontrack=c=>{c.streams[0].getTracks().forEach(t=>{$.addTrack(t)})},N.srcObject=j,ee.srcObject=$,N.play(),ee.play(),F.disabled=!1,Y.disabled=!1,U.disabled=!0;const s=document.getElementById("muteMonitor");s.checked==!0?N.muted=!0:N.muted=!1,s.addEventListener("change",function(){s.checked==!0?(N.muted=!0,console.log("monitor muted")):(N.muted=!1,console.log("monitor unmuted"))});const r=document.getElementById("muteMe");r.checked=!1,r.addEventListener("change",function(){r.checked==!0?(A.getTracks()[0].enabled=!1,console.log("muted me")):(A.getTracks()[0].enabled=!0,console.log("unmuted me"))})};const w=ce();F.onclick=async()=>{p=m.createDataChannel("sendDataChannel"),p.onopen=g=>{console.log("send channel opened")},p.onclose=g=>{console.log("send channel closed")},m.ondatachannel=g=>{b=g.channel,b.onmessage=async u=>{switch(a=!0,e=JSON.parse(u.data),e.whatChanged){case"comp.threshold":await(D.value=e.comp.threshold),a=!1;break;case"comp.release":await(k.value=e.comp.release),a=!1;break;case"comp.attack":await(E.value=e.comp.attack),a=!1;break;case"comp.knee":await(B.value=e.comp.knee),a=!1;break;case"comp.ratio":await(I.value=e.comp.ratio),a=!1;break;case"comp.reduction":await(comp_recduction.value=e.comp.reduction),a=!1;break;case"eq.type":await(C.value=e.eq.type),a=!1;break;case"eq.freq":await(q.value=e.eq.freq),a=!1;break;case"eq.low":await(M.value=e.eq.low),a=!1;break;case"eq.mid":await(_.value=e.eq.mid),a=!1;break;case"eq.high":await(z.value=e.eq.high),a=!1;break;case"pan.pan":await(S.value=e.pan.pan),a=!1;break;case"gain.gain":await(y.value=e.gain.gain),a=!1;break;case"comp.bypass":await(O.state=e.comp.bypass),a=!1;break;case"eq.bypass":await(T.state=e.eq.bypass),a=!1;break;case"gain.bypass":await(J.state=e.gain.bypass),a=!1;break;case"pan.bypass":await(P.state=e.pan.bypass),a=!1;break;default:console.log("invalid exchanged value"),a=!1;break}},b.onopen=u=>{console.log("receive channel opened"),f()},b.onclose=u=>{console.log("receive channel closed"),f()}};let s=document.createTextNode("You created a call.");ae.appendChild(s),F.disabled=!0,Y.disabled=!0;const r=x(w,"calls1"),c=await H(r,{});W.value=c.id;const t=x(w,"calls1",c.id,"offerCandidates"),n=x(w,"calls1",c.id,"answerCandidates");m.onicecandidate=g=>{g.candidate&&H(t,g.candidate.toJSON()),console.log("PA updated candidates in database"),f()};const i=await m.createOffer().then(console.log("PA created offer"));f(),i.sdp=i.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await m.setLocalDescription(i).then(console.log("PA set local desc")),f();const d={sdp:i.sdp,type:i.type};await ie(G(w,"calls1",c.id),{offer:d}).then(console.log("PA updated offer in database")),f();const v=K(G(w,"calls1",c.id));Q(v,g=>{const u=g.data();if(!m.currentRemoteDescription&&(u==null?void 0:u.answer)){console.log("listen to answer triggered"),f();const l=new RTCSessionDescription(u.answer);m.setRemoteDescription(l),console.log("PA set remote desc",l),f()}});const h=K(n);Q(h,g=>{g.docChanges().forEach(u=>{if(u.type==="added"){console.log("listen to answerCandidates triggered"),f();const l=new RTCIceCandidate(u.doc.data());m.addIceCandidate(l),console.log("PA added ICE Candi: ",l),f()}})}),fe.disabled=!1};Y.onclick=async()=>{p=m.createDataChannel("sendDataChannel2"),p.onopen=u=>{console.log("send channel opened")},p.onclose=u=>{console.log("send channel closed")},m.ondatachannel=u=>{b=u.channel,b.onmessage=async l=>{switch(a=!0,e=JSON.parse(l.data),e.whatChanged){case"comp.threshold":await(D.value=e.comp.threshold),a=!1;break;case"comp.release":await(k.value=e.comp.release),a=!1;break;case"comp.attack":await(E.value=e.comp.attack),a=!1;break;case"comp.knee":await(B.value=e.comp.knee),a=!1;break;case"comp.ratio":await(I.value=e.comp.ratio),a=!1;break;case"comp.reduction":await(comp_recduction.value=e.comp.reduction),a=!1;break;case"eq.type":await(C.value=e.eq.type),a=!1;break;case"eq.freq":await(q.value=e.eq.freq),a=!1;break;case"eq.low":await(M.value=e.eq.low),a=!1;break;case"eq.mid":await(_.value=e.eq.mid),a=!1;break;case"eq.high":await(z.value=e.eq.high),a=!1;break;case"pan.pan":await(S.value=e.pan.pan),a=!1;break;case"gain.gain":await(y.value=e.gain.gain),a=!1;break;case"comp.bypass":await(O.state=e.comp.bypass),a=!1;break;case"eq.bypass":await(T.state=e.eq.bypass),a=!1;break;case"gain.bypass":await(J.state=e.gain.bypass),a=!1;break;case"pan.bypass":await(P.state=e.pan.bypass),a=!1;break;default:console.log("invalid exchanged value");break}},b.onopen=l=>{console.log("receive channel opened"),f()},b.onclose=l=>{console.log("receive channel closed"),f()}};let s=document.createTextNode("You answered a call!");ae.appendChild(s),F.disabled=!0,Y.disabled=!0;const r=W.value,c=x(w,"calls1"),t=x(w,"calls1",r,"answerCandidates"),n=x(w,"calls1",r,"offerCandidates");m.onicecandidate=u=>{u.candidate&&H(t,u.candidate.toJSON()),console.log("PB updated candidate in database"),f()};const d=(await le(G(c,r))).data().offer;await m.setRemoteDescription(new RTCSessionDescription(d)),console.log("PB set remote desc"),f();const v=await m.createAnswer();v.sdp=v.sdp.replace("useinbandfec=1","useinbandfec=1; stereo=1; maxaveragebitrate=510000"),await m.setLocalDescription(v),console.log("PB set local desc"),f();const h={type:v.type,sdp:v.sdp};await re(G(w,"calls1",r),{answer:h}),console.log("PB updated answer in database"),f();const g=K(n);Q(g,u=>{u.docChanges().forEach(l=>{if(l.type==="added"){let o=l.doc.data(),V=new RTCIceCandidate(o);m.addIceCandidate(V),console.log("PB added ICE Candi: ",V),f()}})})};async function ke(){var s=new AudioContext,r=s.createMediaStreamSource(A),c=s.createMediaStreamDestination();j=c.stream,console.log(j);var t=s.createBiquadFilter();t.type=C.value,t.frequency.value=q.value,t.gain.value=y.value;var n=s.createStereoPanner();n.pan.value=S.value;var i=s.createGain();i.gain.value=y.value;var d=s.createDynamicsCompressor();d.release.value=k.value;var v=s.createConvolver(),h=new XMLHttpRequest;h.open("GET","https://talker93.github.io/pb/audio/Block%20Inside.wav",!0),h.responseType="arraybuffer",h.onload=function(){var l=h.response;s.decodeAudioData(l,function(o){s.createBufferSource(),v.buffer=o},function(o){""+o.err})},h.send(),r.connect(d),d.connect(t),t.connect(v),v.connect(i),i.connect(n),n.connect(c),D.on("change",function(l){if(d.threshold.value=D.value,e.comp.threshold=D.value,e.whatChanged="comp.threshold",!a){const o=JSON.stringify(e);try{p.send(o)}catch(V){console.error(V)}console.log("threshold: ",e.comp.threshold)}}),k.on("change",function(l){if(d.release.value=k.value,e.comp.release=k.value,e.whatChanged="comp.release",!a){const o=JSON.stringify(e);p.send(o)}}),E.on("change",function(l){if(d.attack.value=E.value,e.comp.attack=E.value,e.whatChanged="comp.attack",!a){const o=JSON.stringify(e);p.send(o)}}),B.on("change",function(l){if(d.knee.value=B.value,e.comp.knee=B.value,e.whatChanged="comp.knee",!a){const o=JSON.stringify(e);p.send(o)}}),I.on("change",function(l){if(d.ratio.value=I.value,e.comp.ratio=I.value,e.whatChanged="comp.ratio",!a){const o=JSON.stringify(e);p.send(o)}}),C.on("change",function(l){if(t.type=C.value,e.eq.type=C.value,e.whatChanged="eq.type",!a){const o=JSON.stringify(e);p.send(o)}}),q.on("change",function(l){if(t.frequency.value=q.value,e.eq.freq=q.value,e.whatChanged="eq.freq",!a){const o=JSON.stringify(e);p.send(o)}}),M.on("change",function(l){if(t.gain.value=M.value,e.eq.low=M.value,e.whatChanged="eq.low",!a){const o=JSON.stringify(e);p.send(o)}}),_.on("change",function(l){if(t.gain.value=_.value,e.eq.mid=_.value,e.whatChanged="eq.mid",!a){const o=JSON.stringify(e);p.send(o)}}),z.on("change",function(l){if(t.gain.value=z.value,e.eq.high=z.value,e.whatChanged="eq.high",!a){const o=JSON.stringify(e);p.send(o)}}),S.on("change",function(l){if(n.pan.value=S.value,e.pan.pan=S.value,e.whatChanged="pan.pan",!a){const o=JSON.stringify(e);p.send(o)}}),y.on("change",function(l){if(i.gain.value=y.value,e.gain.gain=y.value,e.whatChanged="gain.gain",!a){const o=JSON.stringify(e);p.send(o)}}),O.on("change",function(l){if(O.state==!0?(d.disconnect(),r.connect(t)):(r.disconnect(t),r.connect(d),d.connect(t)),e.comp.bypass=O.state,e.whatChanged="comp.bypass",!a){const o=JSON.stringify(e);p.send(o)}}),T.on("change",function(l){if(T.state==!0?(t.disconnect(),d.connect(i)):(d.disconnect(i),d.connect(t),t.connect(i)),e.eq.bypass=T.state,e.whatChanged="eq.bypass",!a){const o=JSON.stringify(e);p.send(o)}}),J.on("change",function(l){if(J.state==!0?(i.disconnect(),t.connect(n)):(t.disconnect(n),t.connect(i),i.connect(n)),e.gain.bypass=J.state,e.whatChanged="gain.bypass",!a){const o=JSON.stringify(e);p.send(o)}}),P.on("change",function(l){if(P.state==!0?(n.disconnect(),i.connect(c)):(i.disconnect(c),i.connect(n),n.connect(c)),e.pan.bypass=P.state,e.whatChanged="pan.bypass",!a){const o=JSON.stringify(e);p.send(o)}});var g=new Nexus.Oscilloscope("#oScope");g.connect(r);var u=new Nexus.Spectrogram("#spec");u.connect(r)}function Ce(s){s.onicegatheringstatechange=r=>{console.log("iceGatheringState: ",s.iceGatheringState),f()},s.oniceconnectionstatechange=r=>{console.log("iceConnectionState: ",s.iceConnectionState),f()},s.onconnectionstatechange=r=>{console.log("connectionState: ",s.connectionState),f()}}function f(){Z=Math.floor(Date.now()%1e5),console.log("time elapsed: ",Z)}
